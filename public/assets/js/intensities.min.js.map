{"version":3,"sources":["intensities.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","serialize","form","options","hash","undefined","result","serializer","hash_serializer","str_serialize","elements","radio_store","Object","create","element","disabled","name","k_r_success_contrls","test","nodeName","k_r_submitter","type","key","val","value","checked","empty","selectOptions","isSelectedOptions","j","option","allowedEmpty","hasValue","selected","slice","parse_keys","string","keys","prefix","children","RegExp","brackets","match","exec","push","hash_assign","shift","between","Array","isArray","_values","index","isNaN","matches","existing","replace","encodeURIComponent","2","global","param","add","k","v","buildParams","obj","len","prototype","toString","hasOwnProperty","join","define","amd","this","3","factory","m","window","isFunction","object","isObject","isString","noop","initialize","mock","$document","document","$location","location","$cancelAnimationFrame","cancelAnimationFrame","clearTimeout","$requestAnimationFrame","requestAnimationFrame","setTimeout","parseTagAttrs","cell","tag","classes","parser","attrs","id","pair","getVirtualChildren","args","hasAttrs","assignAttrs","target","classAttr","attrName","hasOwn","pairs","arguments","parameterize","forEach","list","forKeys","dataToString","data","injectTextNode","parentElement","first","insertNode","nodeValue","flatten","concat","apply","node","insertBefore","childNodes","handleKeysDiffer","cached","action","MOVE","from","nodes","createElement","INSERTION","actions","prop","changes","sort","sortChanges","newCached","change","DELETION","clear","splice","dummy","changeElement","maybeChanged","diffKeys","keysDiffer","cachedCell","diffArray","_","parentNode","indexOf","buildArrayKeys","guid","isDifferentEnough","dataAttrKeys","redraw","strategy","configContext","retain","maybeRecreateObject","onunload","controllers","controller","preventDefault","getObjectNamespace","namespace","xmlns","unloadCachedControllers","views","$old","pendingRequests","scheduleConfigsToBeCalled","configs","isNew","config","context","buildUpdatedNode","editable","hasKeys","setAttributes","build","contenteditable","intact","handleNonexistentNodes","$trusted","injectHTML","createTextNode","voidElements","constructor","reattachNodes","parentTag","activeElement","innerHTML","nodeType","trim","handleTextNode","shouldReattach","valueOf","getSubArrayCount","item","buildArray","subArrayCount","shouldMaintainIdentities","cacheCount","makeCache","parentIndex","parentCache","offset","end","constructNode","is","createElementNS","constructAttrs","constructChildren","reconstructCached","getController","view","cachedControllers","controllerIndex","updateLists","unloaders","map","handler","checkView","forcing","subtree","markViews","$original","buildObject","b","copyStyleAttrs","dataAttr","cachedAttr","rule","style","setSingleAttr","autoredraw","setAttributeNS","setAttribute","shouldUseSetAttribute","trySetAttr","cachedAttrs","message","dataAttrs","removeChild","unload","appendTextFragment","appendChild","createRange","createContextualFragment","insertAdjacentHTML","replaceScriptNodes","tagName","replaceChild","buildExecutableNode","scriptEl","attributes","text","nextSibling","isElement","placeholder","callback","event","startComputation","endFirstComputation","getCellCacheKey","nodeCache","gettersetter","store","toJSON","component","ctrl","currentArgs","output","checkPrevented","root","isPrevented","roots","currentComponent","topComponent","components","removeRootElement","reset","computePreRedrawHook","render","computePostRedrawHook","lastRedrawId","lastRedrawCallTime","Date","endComputation","normalizeRoute","route","modes","mode","routeByValue","router","path","routeParams","queryStart","parseQueryString","substr","mount","matcher","values","decodeURIComponent","routeUnobtrusive","ctrlKey","metaKey","shiftKey","which","returnValue","currentTarget","srcElement","search","setScroll","scrollTo","buildQueryString","duplicates","str","charAt","split","params","cacheKey","cellCache","propify","promise","initialValue","then","resolve","reject","catch","bind","Deferred","onSuccess","onFailure","finish","state","REJECTED","next","deferred","RESOLVED","promiseValue","thennable","success","failure","notThennable","count","onerror","fire","REJECTING","RESOLVING","self","TypeError","identity","handleJsonp","callbackKey","callbackName","getTime","Math","round","random","script","resp","onload","responseText","status","JSON","stringify","error","src","url","body","createXhr","xhr","XMLHttpRequest","open","method","user","password","onreadystatechange","readyState","setRequestHeader","deserialize","parse","maybeXhr","FormData","send","ajax","dataType","toLowerCase","bindData","querystring","parameterizeUrl","token","version","AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR","deps","html","width","height","documentNode","documentElement","forceRecreation","isDocumentRoot","trust","String","Promise","FRAME_BUDGET","unloader","redrawing","force","withAttr","withAttrCallback","callbackThis","_this","getAttribute","currentRoute","pathname","redirect","isDefaultRoute","arg1","arg2","vdom","source","listener","addEventListener","attachEvent","base","href","removeEventListener","detachEvent","oldRoute","queryIndex","currentPath","replaceHistory","history","pushState","title","err","sync","synchronizer","pos","resolved","results","outstanding","arg","request","background","extract","isJSONP","jsonp","toUpperCase","ev","response","unwrapSuccess","res","unwrapError","4","process","defer","setImmediate","undef","pinkySwear","extend","set","newState","newValues","onFulfilled","onRejected","promise2","callCallbacks","x","cbCalled","_process","5","runTimeout","fun","cachedSetTimeout","runClearTimeout","marker","cachedClearTimeout","cleanUpNextTick","draining","currentQueue","queue","queueIndex","drainQueue","timeout","run","Item","array","nextTick","browser","env","argv","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","cwd","chdir","dir","umask","6","pinkyswear","jparam","defaultOptions","defaultXdrResponseType","defaultDataType","limit","requests","request_stack","getXHR","ActiveXObject","xhr2","responseType","qwest","before","name2","crossOrigin","nativeResponseParsing","xdr","aborted","attempts","headers","mimeTypes","xml","json","post","accept","sending","pinky","abort","XDomainRequest","async","withCredentials","handleResponse","handleError","onprogress","ontimeout","handleTimeout","overrideMimeType","ct","getResponseHeader","Function","DOMParser","parseFromString","loadXML","getElementsByTagName","statusText","cache","parseInt","host","ArrayBuffer","Blob","Document","format","p1","p2","Accept","getNewPromise","q","promises","loading","method_index","createMethod","get","put","complete","func","delete","by","setDefaultOptions","setDefaultXdrResponseType","setDefaultDataType","getOpenRequests","jquery-param","7","maxHeartRate","0","calculating","analysis","totals","zones","onclick","max","min","onchange","localStorage","aggregate","activities","getZoneForHeartRateValue","heartRate","getElementById","activityId","activity","getActivity","console","log","max_heartrate","max_speed","maxSpeed","distance","movingTime","moving_time","HeartRate","Data","zoneIndex","total","pace","./views/activities.js","./views/analysis.js","form-serialize","mithril","8","selectMultiple","lastChecked","querySelectorAll","inRange","date","start_date_local","toDateString","elapsed_time","average_heartrate","9","percentage","ltrim","char","zonePercentages","setSeconds","maxPace","toISOString"],"mappings":"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","file":"intensities.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n// get successful control from form and assemble into object\n// http://www.w3.org/TR/html401/interact/forms.html#h-17.13.2\n\n// types which indicate a submit action and are not successful controls\n// these will be ignored\nvar k_r_submitter = /^(?:submit|button|image|reset|file)$/i;\n\n// node names which could be successful controls\nvar k_r_success_contrls = /^(?:input|select|textarea|keygen)/i;\n\n// Matches bracket notation.\nvar brackets = /(\\[[^\\[\\]]*\\])/g;\n\n// serializes form fields\n// @param form MUST be an HTMLForm element\n// @param options is an optional argument to configure the serialization. Default output\n// with no options specified is a url encoded string\n//    - hash: [true | false] Configure the output type. If true, the output will\n//    be a js object.\n//    - serializer: [function] Optional serializer function to override the default one.\n//    The function takes 3 arguments (result, key, value) and should return new result\n//    hash and url encoded str serializers are provided with this module\n//    - disabled: [true | false]. If true serialize disabled fields.\n//    - empty: [true | false]. If true serialize empty fields\nfunction serialize(form, options) {\n    if (typeof options != 'object') {\n        options = { hash: !!options };\n    }\n    else if (options.hash === undefined) {\n        options.hash = true;\n    }\n\n    var result = (options.hash) ? {} : '';\n    var serializer = options.serializer || ((options.hash) ? hash_serializer : str_serialize);\n\n    var elements = form && form.elements ? form.elements : [];\n\n    //Object store each radio and set if it's empty or not\n    var radio_store = Object.create(null);\n\n    for (var i=0 ; i<elements.length ; ++i) {\n        var element = elements[i];\n\n        // ingore disabled fields\n        if ((!options.disabled && element.disabled) || !element.name) {\n            continue;\n        }\n        // ignore anyhting that is not considered a success field\n        if (!k_r_success_contrls.test(element.nodeName) ||\n            k_r_submitter.test(element.type)) {\n            continue;\n        }\n\n        var key = element.name;\n        var val = element.value;\n\n        // we can't just use element.value for checkboxes cause some browsers lie to us\n        // they say \"on\" for value when the box isn't checked\n        if ((element.type === 'checkbox' || element.type === 'radio') && !element.checked) {\n            val = undefined;\n        }\n\n        // If we want empty elements\n        if (options.empty) {\n            // for checkbox\n            if (element.type === 'checkbox' && !element.checked) {\n                val = '';\n            }\n\n            // for radio\n            if (element.type === 'radio') {\n                if (!radio_store[element.name] && !element.checked) {\n                    radio_store[element.name] = false;\n                }\n                else if (element.checked) {\n                    radio_store[element.name] = true;\n                }\n            }\n\n            // if options empty is true, continue only if its radio\n            if (!val && element.type == 'radio') {\n                continue;\n            }\n        }\n        else {\n            // value-less fields are ignored unless options.empty is true\n            if (!val) {\n                continue;\n            }\n        }\n\n        // multi select boxes\n        if (element.type === 'select-multiple') {\n            val = [];\n\n            var selectOptions = element.options;\n            var isSelectedOptions = false;\n            for (var j=0 ; j<selectOptions.length ; ++j) {\n                var option = selectOptions[j];\n                var allowedEmpty = options.empty && !option.value;\n                var hasValue = (option.value || allowedEmpty);\n                if (option.selected && hasValue) {\n                    isSelectedOptions = true;\n\n                    // If using a hash serializer be sure to add the\n                    // correct notation for an array in the multi-select\n                    // context. Here the name attribute on the select element\n                    // might be missing the trailing bracket pair. Both names\n                    // \"foo\" and \"foo[]\" should be arrays.\n                    if (options.hash && key.slice(key.length - 2) !== '[]') {\n                        result = serializer(result, key + '[]', option.value);\n                    }\n                    else {\n                        result = serializer(result, key, option.value);\n                    }\n                }\n            }\n\n            // Serialize if no selected options and options.empty is true\n            if (!isSelectedOptions && options.empty) {\n                result = serializer(result, key, '');\n            }\n\n            continue;\n        }\n\n        result = serializer(result, key, val);\n    }\n\n    // Check for all empty radio buttons and serialize them with key=\"\"\n    if (options.empty) {\n        for (var key in radio_store) {\n            if (!radio_store[key]) {\n                result = serializer(result, key, '');\n            }\n        }\n    }\n\n    return result;\n}\n\nfunction parse_keys(string) {\n    var keys = [];\n    var prefix = /^([^\\[\\]]*)/;\n    var children = new RegExp(brackets);\n    var match = prefix.exec(string);\n\n    if (match[1]) {\n        keys.push(match[1]);\n    }\n\n    while ((match = children.exec(string)) !== null) {\n        keys.push(match[1]);\n    }\n\n    return keys;\n}\n\nfunction hash_assign(result, keys, value) {\n    if (keys.length === 0) {\n        result = value;\n        return result;\n    }\n\n    var key = keys.shift();\n    var between = key.match(/^\\[(.+?)\\]$/);\n\n    if (key === '[]') {\n        result = result || [];\n\n        if (Array.isArray(result)) {\n            result.push(hash_assign(null, keys, value));\n        }\n        else {\n            // This might be the result of bad name attributes like \"[][foo]\",\n            // in this case the original `result` object will already be\n            // assigned to an object literal. Rather than coerce the object to\n            // an array, or cause an exception the attribute \"_values\" is\n            // assigned as an array.\n            result._values = result._values || [];\n            result._values.push(hash_assign(null, keys, value));\n        }\n\n        return result;\n    }\n\n    // Key is an attribute name and can be assigned directly.\n    if (!between) {\n        result[key] = hash_assign(result[key], keys, value);\n    }\n    else {\n        var string = between[1];\n        // +var converts the variable into a number\n        // better than parseInt because it doesn't truncate away trailing\n        // letters and actually fails if whole thing is not a number\n        var index = +string;\n\n        // If the characters between the brackets is not a number it is an\n        // attribute name and can be assigned directly.\n        if (isNaN(index)) {\n            result = result || {};\n            result[string] = hash_assign(result[string], keys, value);\n        }\n        else {\n            result = result || [];\n            result[index] = hash_assign(result[index], keys, value);\n        }\n    }\n\n    return result;\n}\n\n// Object/hash encoding serializer.\nfunction hash_serializer(result, key, value) {\n    var matches = key.match(brackets);\n\n    // Has brackets? Use the recursive assignment function to walk the keys,\n    // construct any missing objects in the result tree and make the assignment\n    // at the end of the chain.\n    if (matches) {\n        var keys = parse_keys(key);\n        hash_assign(result, keys, value);\n    }\n    else {\n        // Non bracket notation can make assignments directly.\n        var existing = result[key];\n\n        // If the value has been assigned already (for instance when a radio and\n        // a checkbox have the same name attribute) convert the previous value\n        // into an array before pushing into it.\n        //\n        // NOTE: If this requirement were removed all hash creation and\n        // assignment could go through `hash_assign`.\n        if (existing) {\n            if (!Array.isArray(existing)) {\n                result[key] = [ existing ];\n            }\n\n            result[key].push(value);\n        }\n        else {\n            result[key] = value;\n        }\n    }\n\n    return result;\n}\n\n// urlform encoding serializer\nfunction str_serialize(result, key, value) {\n    // encode newlines as \\r\\n cause the html spec says so\n    value = value.replace(/(\\r)?\\n/g, '\\r\\n');\n    value = encodeURIComponent(value);\n\n    // spaces should be '+' rather than '%20'.\n    value = value.replace(/%20/g, '+');\n    return result + (result ? '&' : '') + encodeURIComponent(key) + '=' + value;\n}\n\nmodule.exports = serialize;\n\n},{}],2:[function(require,module,exports){\n/**\n * @preserve jquery-param (c) 2015 KNOWLEDGECODE | MIT\n */\n/*global define */\n(function (global) {\n    'use strict';\n\n    var param = function (a) {\n        var add = function (s, k, v) {\n            v = typeof v === 'function' ? v() : v === null ? '' : v === undefined ? '' : v;\n            s[s.length] = encodeURIComponent(k) + '=' + encodeURIComponent(v);\n        }, buildParams = function (prefix, obj, s) {\n            var i, len, key;\n\n            if (Object.prototype.toString.call(obj) === '[object Array]') {\n                for (i = 0, len = obj.length; i < len; i++) {\n                    buildParams(prefix + '[' + (typeof obj[i] === 'object' ? i : '') + ']', obj[i], s);\n                }\n            } else if (obj && obj.toString() === '[object Object]') {\n                for (key in obj) {\n                    if (obj.hasOwnProperty(key)) {\n                        if (prefix) {\n                            buildParams(prefix + '[' + key + ']', obj[key], s, add);\n                        } else {\n                            buildParams(key, obj[key], s, add);\n                        }\n                    }\n                }\n            } else if (prefix) {\n                add(s, prefix, obj);\n            } else {\n                for (key in obj) {\n                    add(s, key, obj[key]);\n                }\n            }\n            return s;\n        };\n        return buildParams('', a, []).join('&').replace(/%20/g, '+');\n    };\n\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        module.exports = param;\n    } else if (typeof define === 'function' && define.amd) {\n        define([], function () {\n            return param;\n        });\n    } else {\n        global.param = param;\n    }\n\n}(this));\n\n},{}],3:[function(require,module,exports){\n;(function (global, factory) { // eslint-disable-line\r\n\t\"use strict\"\r\n\t/* eslint-disable no-undef */\r\n\tvar m = factory(global)\r\n\tif (typeof module === \"object\" && module != null && module.exports) {\r\n\t\tmodule.exports = m\r\n\t} else if (typeof define === \"function\" && define.amd) {\r\n\t\tdefine(function () { return m })\r\n\t} else {\r\n\t\tglobal.m = m\r\n\t}\r\n\t/* eslint-enable no-undef */\r\n})(typeof window !== \"undefined\" ? window : this, function (global, undefined) { // eslint-disable-line\r\n\t\"use strict\"\r\n\r\n\tm.version = function () {\r\n\t\treturn \"v0.2.5\"\r\n\t}\r\n\r\n\tvar hasOwn = {}.hasOwnProperty\r\n\tvar type = {}.toString\r\n\r\n\tfunction isFunction(object) {\r\n\t\treturn typeof object === \"function\"\r\n\t}\r\n\r\n\tfunction isObject(object) {\r\n\t\treturn type.call(object) === \"[object Object]\"\r\n\t}\r\n\r\n\tfunction isString(object) {\r\n\t\treturn type.call(object) === \"[object String]\"\r\n\t}\r\n\r\n\tvar isArray = Array.isArray || function (object) {\r\n\t\treturn type.call(object) === \"[object Array]\"\r\n\t}\r\n\r\n\tfunction noop() {}\r\n\r\n\tvar voidElements = {\r\n\t\tAREA: 1,\r\n\t\tBASE: 1,\r\n\t\tBR: 1,\r\n\t\tCOL: 1,\r\n\t\tCOMMAND: 1,\r\n\t\tEMBED: 1,\r\n\t\tHR: 1,\r\n\t\tIMG: 1,\r\n\t\tINPUT: 1,\r\n\t\tKEYGEN: 1,\r\n\t\tLINK: 1,\r\n\t\tMETA: 1,\r\n\t\tPARAM: 1,\r\n\t\tSOURCE: 1,\r\n\t\tTRACK: 1,\r\n\t\tWBR: 1\r\n\t}\r\n\r\n\t// caching commonly used variables\r\n\tvar $document, $location, $requestAnimationFrame, $cancelAnimationFrame\r\n\r\n\t// self invoking function needed because of the way mocks work\r\n\tfunction initialize(mock) {\r\n\t\t$document = mock.document\r\n\t\t$location = mock.location\r\n\t\t$cancelAnimationFrame = mock.cancelAnimationFrame || mock.clearTimeout\r\n\t\t$requestAnimationFrame = mock.requestAnimationFrame || mock.setTimeout\r\n\t}\r\n\r\n\t// testing API\r\n\tm.deps = function (mock) {\r\n\t\tinitialize(global = mock || window)\r\n\t\treturn global\r\n\t}\r\n\r\n\tm.deps(global)\r\n\r\n\t/**\r\n\t * @typedef {String} Tag\r\n\t * A string that looks like -> div.classname#id[param=one][param2=two]\r\n\t * Which describes a DOM node\r\n\t */\r\n\r\n\tfunction parseTagAttrs(cell, tag) {\r\n\t\tvar classes = []\r\n\t\tvar parser = /(?:(^|#|\\.)([^#\\.\\[\\]]+))|(\\[.+?\\])/g\r\n\t\tvar match\r\n\r\n\t\twhile ((match = parser.exec(tag))) {\r\n\t\t\tif (match[1] === \"\" && match[2]) {\r\n\t\t\t\tcell.tag = match[2]\r\n\t\t\t} else if (match[1] === \"#\") {\r\n\t\t\t\tcell.attrs.id = match[2]\r\n\t\t\t} else if (match[1] === \".\") {\r\n\t\t\t\tclasses.push(match[2])\r\n\t\t\t} else if (match[3][0] === \"[\") {\r\n\t\t\t\tvar pair = /\\[(.+?)(?:=(\"|'|)(.*?)\\2)?\\]/.exec(match[3])\r\n\t\t\t\tcell.attrs[pair[1]] = pair[3] || \"\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn classes\r\n\t}\r\n\r\n\tfunction getVirtualChildren(args, hasAttrs) {\r\n\t\tvar children = hasAttrs ? args.slice(1) : args\r\n\r\n\t\tif (children.length === 1 && isArray(children[0])) {\r\n\t\t\treturn children[0]\r\n\t\t} else {\r\n\t\t\treturn children\r\n\t\t}\r\n\t}\r\n\r\n\tfunction assignAttrs(target, attrs, classes) {\r\n\t\tvar classAttr = \"class\" in attrs ? \"class\" : \"className\"\r\n\r\n\t\tfor (var attrName in attrs) {\r\n\t\t\tif (hasOwn.call(attrs, attrName)) {\r\n\t\t\t\tif (attrName === classAttr &&\r\n\t\t\t\t\t\tattrs[attrName] != null &&\r\n\t\t\t\t\t\tattrs[attrName] !== \"\") {\r\n\t\t\t\t\tclasses.push(attrs[attrName])\r\n\t\t\t\t\t// create key in correct iteration order\r\n\t\t\t\t\ttarget[attrName] = \"\"\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget[attrName] = attrs[attrName]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (classes.length) target[classAttr] = classes.join(\" \")\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {Tag} The DOM node tag\r\n\t * @param {Object=[]} optional key-value pairs to be mapped to DOM attrs\r\n\t * @param {...mNode=[]} Zero or more Mithril child nodes. Can be an array,\r\n\t *                      or splat (optional)\r\n\t */\r\n\tfunction m(tag, pairs) {\r\n\t\tvar args = []\r\n\r\n\t\tfor (var i = 1, length = arguments.length; i < length; i++) {\r\n\t\t\targs[i - 1] = arguments[i]\r\n\t\t}\r\n\r\n\t\tif (isObject(tag)) return parameterize(tag, args)\r\n\r\n\t\tif (!isString(tag)) {\r\n\t\t\tthrow new Error(\"selector in m(selector, attrs, children) should \" +\r\n\t\t\t\t\"be a string\")\r\n\t\t}\r\n\r\n\t\tvar hasAttrs = pairs != null && isObject(pairs) &&\r\n\t\t\t!(\"tag\" in pairs || \"view\" in pairs || \"subtree\" in pairs)\r\n\r\n\t\tvar attrs = hasAttrs ? pairs : {}\r\n\t\tvar cell = {\r\n\t\t\ttag: \"div\",\r\n\t\t\tattrs: {},\r\n\t\t\tchildren: getVirtualChildren(args, hasAttrs)\r\n\t\t}\r\n\r\n\t\tassignAttrs(cell.attrs, attrs, parseTagAttrs(cell, tag))\r\n\t\treturn cell\r\n\t}\r\n\r\n\tfunction forEach(list, f) {\r\n\t\tfor (var i = 0; i < list.length && !f(list[i], i++);) {\r\n\t\t\t// function called in condition\r\n\t\t}\r\n\t}\r\n\r\n\tfunction forKeys(list, f) {\r\n\t\tforEach(list, function (attrs, i) {\r\n\t\t\treturn (attrs = attrs && attrs.attrs) &&\r\n\t\t\t\tattrs.key != null &&\r\n\t\t\t\tf(attrs, i)\r\n\t\t})\r\n\t}\r\n\t// This function was causing deopts in Chrome.\r\n\tfunction dataToString(data) {\r\n\t\t// data.toString() might throw or return null if data is the return\r\n\t\t// value of Console.log in some versions of Firefox (behavior depends on\r\n\t\t// version)\r\n\t\ttry {\r\n\t\t\tif (data != null && data.toString() != null) return data\r\n\t\t} catch (e) {\r\n\t\t\t// silently ignore errors\r\n\t\t}\r\n\t\treturn \"\"\r\n\t}\r\n\r\n\t// This function was causing deopts in Chrome.\r\n\tfunction injectTextNode(parentElement, first, index, data) {\r\n\t\ttry {\r\n\t\t\tinsertNode(parentElement, first, index)\r\n\t\t\tfirst.nodeValue = data\r\n\t\t} catch (e) {\r\n\t\t\t// IE erroneously throws error when appending an empty text node\r\n\t\t\t// after a null\r\n\t\t}\r\n\t}\r\n\r\n\tfunction flatten(list) {\r\n\t\t// recursively flatten array\r\n\t\tfor (var i = 0; i < list.length; i++) {\r\n\t\t\tif (isArray(list[i])) {\r\n\t\t\t\tlist = list.concat.apply([], list)\r\n\t\t\t\t// check current index again and flatten until there are no more\r\n\t\t\t\t// nested arrays at that index\r\n\t\t\t\ti--\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn list\r\n\t}\r\n\r\n\tfunction insertNode(parentElement, node, index) {\r\n\t\tparentElement.insertBefore(node,\r\n\t\t\tparentElement.childNodes[index] || null)\r\n\t}\r\n\r\n\tvar DELETION = 1\r\n\tvar INSERTION = 2\r\n\tvar MOVE = 3\r\n\r\n\tfunction handleKeysDiffer(data, existing, cached, parentElement) {\r\n\t\tforKeys(data, function (key, i) {\r\n\t\t\texisting[key = key.key] = existing[key] ? {\r\n\t\t\t\taction: MOVE,\r\n\t\t\t\tindex: i,\r\n\t\t\t\tfrom: existing[key].index,\r\n\t\t\t\telement: cached.nodes[existing[key].index] ||\r\n\t\t\t\t\t$document.createElement(\"div\")\r\n\t\t\t} : {action: INSERTION, index: i}\r\n\t\t})\r\n\r\n\t\tvar actions = []\r\n\t\tfor (var prop in existing) {\r\n\t\t\tif (hasOwn.call(existing, prop)) {\r\n\t\t\t\tactions.push(existing[prop])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar changes = actions.sort(sortChanges)\r\n\t\tvar newCached = new Array(cached.length)\r\n\r\n\t\tnewCached.nodes = cached.nodes.slice()\r\n\r\n\t\tforEach(changes, function (change) {\r\n\t\t\tvar index = change.index\r\n\t\t\tif (change.action === DELETION) {\r\n\t\t\t\tclear(cached[index].nodes, cached[index])\r\n\t\t\t\tnewCached.splice(index, 1)\r\n\t\t\t}\r\n\t\t\tif (change.action === INSERTION) {\r\n\t\t\t\tvar dummy = $document.createElement(\"div\")\r\n\t\t\t\tdummy.key = data[index].attrs.key\r\n\t\t\t\tinsertNode(parentElement, dummy, index)\r\n\t\t\t\tnewCached.splice(index, 0, {\r\n\t\t\t\t\tattrs: {key: data[index].attrs.key},\r\n\t\t\t\t\tnodes: [dummy]\r\n\t\t\t\t})\r\n\t\t\t\tnewCached.nodes[index] = dummy\r\n\t\t\t}\r\n\r\n\t\t\tif (change.action === MOVE) {\r\n\t\t\t\tvar changeElement = change.element\r\n\t\t\t\tvar maybeChanged = parentElement.childNodes[index]\r\n\t\t\t\tif (maybeChanged !== changeElement && changeElement !== null) {\r\n\t\t\t\t\tparentElement.insertBefore(changeElement,\r\n\t\t\t\t\t\tmaybeChanged || null)\r\n\t\t\t\t}\r\n\t\t\t\tnewCached[index] = cached[change.from]\r\n\t\t\t\tnewCached.nodes[index] = changeElement\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn newCached\r\n\t}\r\n\r\n\tfunction diffKeys(data, cached, existing, parentElement) {\r\n\t\tvar keysDiffer = data.length !== cached.length\r\n\r\n\t\tif (!keysDiffer) {\r\n\t\t\tforKeys(data, function (attrs, i) {\r\n\t\t\t\tvar cachedCell = cached[i]\r\n\t\t\t\treturn keysDiffer = cachedCell &&\r\n\t\t\t\t\tcachedCell.attrs &&\r\n\t\t\t\t\tcachedCell.attrs.key !== attrs.key\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tif (keysDiffer) {\r\n\t\t\treturn handleKeysDiffer(data, existing, cached, parentElement)\r\n\t\t} else {\r\n\t\t\treturn cached\r\n\t\t}\r\n\t}\r\n\r\n\tfunction diffArray(data, cached, nodes) {\r\n\t\t// diff the array itself\r\n\r\n\t\t// update the list of DOM nodes by collecting the nodes from each item\r\n\t\tforEach(data, function (_, i) {\r\n\t\t\tif (cached[i] != null) nodes.push.apply(nodes, cached[i].nodes)\r\n\t\t})\r\n\t\t// remove items from the end of the array if the new array is shorter\r\n\t\t// than the old one. if errors ever happen here, the issue is most\r\n\t\t// likely a bug in the construction of the `cached` data structure\r\n\t\t// somewhere earlier in the program\r\n\t\tforEach(cached.nodes, function (node, i) {\r\n\t\t\tif (node.parentNode != null && nodes.indexOf(node) < 0) {\r\n\t\t\t\tclear([node], [cached[i]])\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tif (data.length < cached.length) cached.length = data.length\r\n\t\tcached.nodes = nodes\r\n\t}\r\n\r\n\tfunction buildArrayKeys(data) {\r\n\t\tvar guid = 0\r\n\t\tforKeys(data, function () {\r\n\t\t\tforEach(data, function (attrs) {\r\n\t\t\t\tif ((attrs = attrs && attrs.attrs) && attrs.key == null) {\r\n\t\t\t\t\tattrs.key = \"__mithril__\" + guid++\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn 1\r\n\t\t})\r\n\t}\r\n\r\n\tfunction isDifferentEnough(data, cached, dataAttrKeys) {\r\n\t\tif (data.tag !== cached.tag) return true\r\n\r\n\t\tif (dataAttrKeys.sort().join() !==\r\n\t\t\t\tObject.keys(cached.attrs).sort().join()) {\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tif (data.attrs.id !== cached.attrs.id) {\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tif (data.attrs.key !== cached.attrs.key) {\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tif (m.redraw.strategy() === \"all\") {\r\n\t\t\treturn !cached.configContext || cached.configContext.retain !== true\r\n\t\t}\r\n\r\n\t\tif (m.redraw.strategy() === \"diff\") {\r\n\t\t\treturn cached.configContext && cached.configContext.retain === false\r\n\t\t}\r\n\r\n\t\treturn false\r\n\t}\r\n\r\n\tfunction maybeRecreateObject(data, cached, dataAttrKeys) {\r\n\t\t// if an element is different enough from the one in cache, recreate it\r\n\t\tif (isDifferentEnough(data, cached, dataAttrKeys)) {\r\n\t\t\tif (cached.nodes.length) clear(cached.nodes)\r\n\r\n\t\t\tif (cached.configContext &&\r\n\t\t\t\t\tisFunction(cached.configContext.onunload)) {\r\n\t\t\t\tcached.configContext.onunload()\r\n\t\t\t}\r\n\r\n\t\t\tif (cached.controllers) {\r\n\t\t\t\tforEach(cached.controllers, function (controller) {\r\n\t\t\t\t\tif (controller.onunload) {\r\n\t\t\t\t\t\tcontroller.onunload({preventDefault: noop})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getObjectNamespace(data, namespace) {\r\n\t\tif (data.attrs.xmlns) return data.attrs.xmlns\r\n\t\tif (data.tag === \"svg\") return \"http://www.w3.org/2000/svg\"\r\n\t\tif (data.tag === \"math\") return \"http://www.w3.org/1998/Math/MathML\"\r\n\t\treturn namespace\r\n\t}\r\n\r\n\tvar pendingRequests = 0\r\n\tm.startComputation = function () { pendingRequests++ }\r\n\tm.endComputation = function () {\r\n\t\tif (pendingRequests > 1) {\r\n\t\t\tpendingRequests--\r\n\t\t} else {\r\n\t\t\tpendingRequests = 0\r\n\t\t\tm.redraw()\r\n\t\t}\r\n\t}\r\n\r\n\tfunction unloadCachedControllers(cached, views, controllers) {\r\n\t\tif (controllers.length) {\r\n\t\t\tcached.views = views\r\n\t\t\tcached.controllers = controllers\r\n\t\t\tforEach(controllers, function (controller) {\r\n\t\t\t\tif (controller.onunload && controller.onunload.$old) {\r\n\t\t\t\t\tcontroller.onunload = controller.onunload.$old\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (pendingRequests && controller.onunload) {\r\n\t\t\t\t\tvar onunload = controller.onunload\r\n\t\t\t\t\tcontroller.onunload = noop\r\n\t\t\t\t\tcontroller.onunload.$old = onunload\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tfunction scheduleConfigsToBeCalled(configs, data, node, isNew, cached) {\r\n\t\t// schedule configs to be called. They are called after `build` finishes\r\n\t\t// running\r\n\t\tif (isFunction(data.attrs.config)) {\r\n\t\t\tvar context = cached.configContext = cached.configContext || {}\r\n\r\n\t\t\t// bind\r\n\t\t\tconfigs.push(function () {\r\n\t\t\t\treturn data.attrs.config.call(data, node, !isNew, context,\r\n\t\t\t\t\tcached)\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tfunction buildUpdatedNode(\r\n\t\tcached,\r\n\t\tdata,\r\n\t\teditable,\r\n\t\thasKeys,\r\n\t\tnamespace,\r\n\t\tviews,\r\n\t\tconfigs,\r\n\t\tcontrollers\r\n\t) {\r\n\t\tvar node = cached.nodes[0]\r\n\r\n\t\tif (hasKeys) {\r\n\t\t\tsetAttributes(node, data.tag, data.attrs, cached.attrs, namespace)\r\n\t\t}\r\n\r\n\t\tcached.children = build(\r\n\t\t\tnode,\r\n\t\t\tdata.tag,\r\n\t\t\tundefined,\r\n\t\t\tundefined,\r\n\t\t\tdata.children,\r\n\t\t\tcached.children,\r\n\t\t\tfalse,\r\n\t\t\t0,\r\n\t\t\tdata.attrs.contenteditable ? node : editable,\r\n\t\t\tnamespace,\r\n\t\t\tconfigs\r\n\t\t)\r\n\r\n\t\tcached.nodes.intact = true\r\n\r\n\t\tif (controllers.length) {\r\n\t\t\tcached.views = views\r\n\t\t\tcached.controllers = controllers\r\n\t\t}\r\n\r\n\t\treturn node\r\n\t}\r\n\r\n\tfunction handleNonexistentNodes(data, parentElement, index) {\r\n\t\tvar nodes\r\n\t\tif (data.$trusted) {\r\n\t\t\tnodes = injectHTML(parentElement, index, data)\r\n\t\t} else {\r\n\t\t\tnodes = [$document.createTextNode(data)]\r\n\t\t\tif (!(parentElement.nodeName in voidElements)) {\r\n\t\t\t\tinsertNode(parentElement, nodes[0], index)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar cached\r\n\r\n\t\tif (typeof data === \"string\" ||\r\n\t\t\t\ttypeof data === \"number\" ||\r\n\t\t\t\ttypeof data === \"boolean\") {\r\n\t\t\tcached = new data.constructor(data)\r\n\t\t} else {\r\n\t\t\tcached = data\r\n\t\t}\r\n\r\n\t\tcached.nodes = nodes\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction reattachNodes(\r\n\t\tdata,\r\n\t\tcached,\r\n\t\tparentElement,\r\n\t\teditable,\r\n\t\tindex,\r\n\t\tparentTag\r\n\t) {\r\n\t\tvar nodes = cached.nodes\r\n\t\tif (!editable || editable !== $document.activeElement) {\r\n\t\t\tif (data.$trusted) {\r\n\t\t\t\tclear(nodes, cached)\r\n\t\t\t\tnodes = injectHTML(parentElement, index, data)\r\n\t\t\t} else if (parentTag === \"textarea\") {\r\n\t\t\t\t// <textarea> uses `value` instead of `nodeValue`.\r\n\t\t\t\tparentElement.value = data\r\n\t\t\t} else if (editable) {\r\n\t\t\t\t// contenteditable nodes use `innerHTML` instead of `nodeValue`.\r\n\t\t\t\teditable.innerHTML = data\r\n\t\t\t} else {\r\n\t\t\t\t// was a trusted string\r\n\t\t\t\tif (nodes[0].nodeType === 1 || nodes.length > 1 ||\r\n\t\t\t\t\t\t(nodes[0].nodeValue.trim &&\r\n\t\t\t\t\t\t\t!nodes[0].nodeValue.trim())) {\r\n\t\t\t\t\tclear(cached.nodes, cached)\r\n\t\t\t\t\tnodes = [$document.createTextNode(data)]\r\n\t\t\t\t}\r\n\r\n\t\t\t\tinjectTextNode(parentElement, nodes[0], index, data)\r\n\t\t\t}\r\n\t\t}\r\n\t\tcached = new data.constructor(data)\r\n\t\tcached.nodes = nodes\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction handleTextNode(\r\n\t\tcached,\r\n\t\tdata,\r\n\t\tindex,\r\n\t\tparentElement,\r\n\t\tshouldReattach,\r\n\t\teditable,\r\n\t\tparentTag\r\n\t) {\r\n\t\tif (!cached.nodes.length) {\r\n\t\t\treturn handleNonexistentNodes(data, parentElement, index)\r\n\t\t} else if (cached.valueOf() !== data.valueOf() || shouldReattach) {\r\n\t\t\treturn reattachNodes(data, cached, parentElement, editable, index,\r\n\t\t\t\tparentTag)\r\n\t\t} else {\r\n\t\t\treturn (cached.nodes.intact = true, cached)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getSubArrayCount(item) {\r\n\t\tif (item.$trusted) {\r\n\t\t\t// fix offset of next element if item was a trusted string w/ more\r\n\t\t\t// than one html element\r\n\t\t\t// the first clause in the regexp matches elements\r\n\t\t\t// the second clause (after the pipe) matches text nodes\r\n\t\t\tvar match = item.match(/<[^\\/]|\\>\\s*[^<]/g)\r\n\t\t\tif (match != null) return match.length\r\n\t\t} else if (isArray(item)) {\r\n\t\t\treturn item.length\r\n\t\t}\r\n\t\treturn 1\r\n\t}\r\n\r\n\tfunction buildArray(\r\n\t\tdata,\r\n\t\tcached,\r\n\t\tparentElement,\r\n\t\tindex,\r\n\t\tparentTag,\r\n\t\tshouldReattach,\r\n\t\teditable,\r\n\t\tnamespace,\r\n\t\tconfigs\r\n\t) {\r\n\t\tdata = flatten(data)\r\n\t\tvar nodes = []\r\n\t\tvar intact = cached.length === data.length\r\n\t\tvar subArrayCount = 0\r\n\r\n\t\t// keys algorithm: sort elements without recreating them if keys are\r\n\t\t// present\r\n\t\t//\r\n\t\t// 1) create a map of all existing keys, and mark all for deletion\r\n\t\t// 2) add new keys to map and mark them for addition\r\n\t\t// 3) if key exists in new list, change action from deletion to a move\r\n\t\t// 4) for each key, handle its corresponding action as marked in\r\n\t\t//    previous steps\r\n\r\n\t\tvar existing = {}\r\n\t\tvar shouldMaintainIdentities = false\r\n\r\n\t\tforKeys(cached, function (attrs, i) {\r\n\t\t\tshouldMaintainIdentities = true\r\n\t\t\texisting[cached[i].attrs.key] = {action: DELETION, index: i}\r\n\t\t})\r\n\r\n\t\tbuildArrayKeys(data)\r\n\t\tif (shouldMaintainIdentities) {\r\n\t\t\tcached = diffKeys(data, cached, existing, parentElement)\r\n\t\t}\r\n\t\t// end key algorithm\r\n\r\n\t\tvar cacheCount = 0\r\n\t\t// faster explicitly written\r\n\t\tfor (var i = 0, len = data.length; i < len; i++) {\r\n\t\t\t// diff each item in the array\r\n\t\t\tvar item = build(\r\n\t\t\t\tparentElement,\r\n\t\t\t\tparentTag,\r\n\t\t\t\tcached,\r\n\t\t\t\tindex,\r\n\t\t\t\tdata[i],\r\n\t\t\t\tcached[cacheCount],\r\n\t\t\t\tshouldReattach,\r\n\t\t\t\tindex + subArrayCount || subArrayCount,\r\n\t\t\t\teditable,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tconfigs)\r\n\r\n\t\t\tif (item !== undefined) {\r\n\t\t\t\tintact = intact && item.nodes.intact\r\n\t\t\t\tsubArrayCount += getSubArrayCount(item)\r\n\t\t\t\tcached[cacheCount++] = item\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!intact) diffArray(data, cached, nodes)\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction makeCache(data, cached, index, parentIndex, parentCache) {\r\n\t\tif (cached != null) {\r\n\t\t\tif (type.call(cached) === type.call(data)) return cached\r\n\r\n\t\t\tif (parentCache && parentCache.nodes) {\r\n\t\t\t\tvar offset = index - parentIndex\r\n\t\t\t\tvar end = offset + (isArray(data) ? data : cached.nodes).length\r\n\t\t\t\tclear(\r\n\t\t\t\t\tparentCache.nodes.slice(offset, end),\r\n\t\t\t\t\tparentCache.slice(offset, end))\r\n\t\t\t} else if (cached.nodes) {\r\n\t\t\t\tclear(cached.nodes, cached)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcached = new data.constructor()\r\n\t\t// if constructor creates a virtual dom element, use a blank object as\r\n\t\t// the base cached node instead of copying the virtual el (#277)\r\n\t\tif (cached.tag) cached = {}\r\n\t\tcached.nodes = []\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction constructNode(data, namespace) {\r\n\t\tif (data.attrs.is) {\r\n\t\t\tif (namespace == null) {\r\n\t\t\t\treturn $document.createElement(data.tag, data.attrs.is)\r\n\t\t\t} else {\r\n\t\t\t\treturn $document.createElementNS(namespace, data.tag,\r\n\t\t\t\t\tdata.attrs.is)\r\n\t\t\t}\r\n\t\t} else if (namespace == null) {\r\n\t\t\treturn $document.createElement(data.tag)\r\n\t\t} else {\r\n\t\t\treturn $document.createElementNS(namespace, data.tag)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction constructAttrs(data, node, namespace, hasKeys) {\r\n\t\tif (hasKeys) {\r\n\t\t\treturn setAttributes(node, data.tag, data.attrs, {}, namespace)\r\n\t\t} else {\r\n\t\t\treturn data.attrs\r\n\t\t}\r\n\t}\r\n\r\n\tfunction constructChildren(\r\n\t\tdata,\r\n\t\tnode,\r\n\t\tcached,\r\n\t\teditable,\r\n\t\tnamespace,\r\n\t\tconfigs\r\n\t) {\r\n\t\tif (data.children != null && data.children.length > 0) {\r\n\t\t\treturn build(\r\n\t\t\t\tnode,\r\n\t\t\t\tdata.tag,\r\n\t\t\t\tundefined,\r\n\t\t\t\tundefined,\r\n\t\t\t\tdata.children,\r\n\t\t\t\tcached.children,\r\n\t\t\t\ttrue,\r\n\t\t\t\t0,\r\n\t\t\t\tdata.attrs.contenteditable ? node : editable,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tconfigs)\r\n\t\t} else {\r\n\t\t\treturn data.children\r\n\t\t}\r\n\t}\r\n\r\n\tfunction reconstructCached(\r\n\t\tdata,\r\n\t\tattrs,\r\n\t\tchildren,\r\n\t\tnode,\r\n\t\tnamespace,\r\n\t\tviews,\r\n\t\tcontrollers\r\n\t) {\r\n\t\tvar cached = {\r\n\t\t\ttag: data.tag,\r\n\t\t\tattrs: attrs,\r\n\t\t\tchildren: children,\r\n\t\t\tnodes: [node]\r\n\t\t}\r\n\r\n\t\tunloadCachedControllers(cached, views, controllers)\r\n\r\n\t\tif (cached.children && !cached.children.nodes) {\r\n\t\t\tcached.children.nodes = []\r\n\t\t}\r\n\r\n\t\t// edge case: setting value on <select> doesn't work before children\r\n\t\t// exist, so set it again after children have been created\r\n\t\tif (data.tag === \"select\" && \"value\" in data.attrs) {\r\n\t\t\tsetAttributes(node, data.tag, {value: data.attrs.value}, {},\r\n\t\t\t\tnamespace)\r\n\t\t}\r\n\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction getController(views, view, cachedControllers, controller) {\r\n\t\tvar controllerIndex\r\n\r\n\t\tif (m.redraw.strategy() === \"diff\" && views) {\r\n\t\t\tcontrollerIndex = views.indexOf(view)\r\n\t\t} else {\r\n\t\t\tcontrollerIndex = -1\r\n\t\t}\r\n\r\n\t\tif (controllerIndex > -1) {\r\n\t\t\treturn cachedControllers[controllerIndex]\r\n\t\t} else if (isFunction(controller)) {\r\n\t\t\treturn new controller()\r\n\t\t} else {\r\n\t\t\treturn {}\r\n\t\t}\r\n\t}\r\n\r\n\tvar unloaders = []\r\n\r\n\tfunction updateLists(views, controllers, view, controller) {\r\n\t\tif (controller.onunload != null &&\r\n\t\t\t\tunloaders.map(function (u) { return u.handler })\r\n\t\t\t\t\t.indexOf(controller.onunload) < 0) {\r\n\t\t\tunloaders.push({\r\n\t\t\t\tcontroller: controller,\r\n\t\t\t\thandler: controller.onunload\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tviews.push(view)\r\n\t\tcontrollers.push(controller)\r\n\t}\r\n\r\n\tvar forcing = false\r\n\tfunction checkView(\r\n\t\tdata,\r\n\t\tview,\r\n\t\tcached,\r\n\t\tcachedControllers,\r\n\t\tcontrollers,\r\n\t\tviews\r\n\t) {\r\n\t\tvar controller = getController(\r\n\t\t\tcached.views,\r\n\t\t\tview,\r\n\t\t\tcachedControllers,\r\n\t\t\tdata.controller)\r\n\r\n\t\tvar key = data && data.attrs && data.attrs.key\r\n\r\n\t\tif (pendingRequests === 0 ||\r\n\t\t\t\tforcing ||\r\n\t\t\t\tcachedControllers &&\r\n\t\t\t\t\tcachedControllers.indexOf(controller) > -1) {\r\n\t\t\tdata = data.view(controller)\r\n\t\t} else {\r\n\t\t\tdata = {tag: \"placeholder\"}\r\n\t\t}\r\n\r\n\t\tif (data.subtree === \"retain\") return data\r\n\t\tdata.attrs = data.attrs || {}\r\n\t\tdata.attrs.key = key\r\n\t\tupdateLists(views, controllers, view, controller)\r\n\t\treturn data\r\n\t}\r\n\r\n\tfunction markViews(data, cached, views, controllers) {\r\n\t\tvar cachedControllers = cached && cached.controllers\r\n\r\n\t\twhile (data.view != null) {\r\n\t\t\tdata = checkView(\r\n\t\t\t\tdata,\r\n\t\t\t\tdata.view.$original || data.view,\r\n\t\t\t\tcached,\r\n\t\t\t\tcachedControllers,\r\n\t\t\t\tcontrollers,\r\n\t\t\t\tviews)\r\n\t\t}\r\n\r\n\t\treturn data\r\n\t}\r\n\r\n\tfunction buildObject( // eslint-disable-line max-statements\r\n\t\tdata,\r\n\t\tcached,\r\n\t\teditable,\r\n\t\tparentElement,\r\n\t\tindex,\r\n\t\tshouldReattach,\r\n\t\tnamespace,\r\n\t\tconfigs\r\n\t) {\r\n\t\tvar views = []\r\n\t\tvar controllers = []\r\n\r\n\t\tdata = markViews(data, cached, views, controllers)\r\n\r\n\t\tif (data.subtree === \"retain\") return cached\r\n\r\n\t\tif (!data.tag && controllers.length) {\r\n\t\t\tthrow new Error(\"Component template must return a virtual \" +\r\n\t\t\t\t\"element, not an array, string, etc.\")\r\n\t\t}\r\n\r\n\t\tdata.attrs = data.attrs || {}\r\n\t\tcached.attrs = cached.attrs || {}\r\n\r\n\t\tvar dataAttrKeys = Object.keys(data.attrs)\r\n\t\tvar hasKeys = dataAttrKeys.length > (\"key\" in data.attrs ? 1 : 0)\r\n\r\n\t\tmaybeRecreateObject(data, cached, dataAttrKeys)\r\n\r\n\t\tif (!isString(data.tag)) return\r\n\r\n\t\tvar isNew = cached.nodes.length === 0\r\n\r\n\t\tnamespace = getObjectNamespace(data, namespace)\r\n\r\n\t\tvar node\r\n\t\tif (isNew) {\r\n\t\t\tnode = constructNode(data, namespace)\r\n\t\t\t// set attributes first, then create children\r\n\t\t\tvar attrs = constructAttrs(data, node, namespace, hasKeys)\r\n\r\n\t\t\t// add the node to its parent before attaching children to it\r\n\t\t\tinsertNode(parentElement, node, index)\r\n\r\n\t\t\tvar children = constructChildren(data, node, cached, editable,\r\n\t\t\t\tnamespace, configs)\r\n\r\n\t\t\tcached = reconstructCached(\r\n\t\t\t\tdata,\r\n\t\t\t\tattrs,\r\n\t\t\t\tchildren,\r\n\t\t\t\tnode,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tviews,\r\n\t\t\t\tcontrollers)\r\n\t\t} else {\r\n\t\t\tnode = buildUpdatedNode(\r\n\t\t\t\tcached,\r\n\t\t\t\tdata,\r\n\t\t\t\teditable,\r\n\t\t\t\thasKeys,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tviews,\r\n\t\t\t\tconfigs,\r\n\t\t\t\tcontrollers)\r\n\t\t}\r\n\r\n\t\tif (!isNew && shouldReattach === true && node != null) {\r\n\t\t\tinsertNode(parentElement, node, index)\r\n\t\t}\r\n\r\n\t\t// The configs are called after `build` finishes running\r\n\t\tscheduleConfigsToBeCalled(configs, data, node, isNew, cached)\r\n\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction build(\r\n\t\tparentElement,\r\n\t\tparentTag,\r\n\t\tparentCache,\r\n\t\tparentIndex,\r\n\t\tdata,\r\n\t\tcached,\r\n\t\tshouldReattach,\r\n\t\tindex,\r\n\t\teditable,\r\n\t\tnamespace,\r\n\t\tconfigs\r\n\t) {\r\n\t\t/*\r\n\t\t * `build` is a recursive function that manages creation/diffing/removal\r\n\t\t * of DOM elements based on comparison between `data` and `cached` the\r\n\t\t * diff algorithm can be summarized as this:\r\n\t\t *\r\n\t\t * 1 - compare `data` and `cached`\r\n\t\t * 2 - if they are different, copy `data` to `cached` and update the DOM\r\n\t\t *     based on what the difference is\r\n\t\t * 3 - recursively apply this algorithm for every array and for the\r\n\t\t *     children of every virtual element\r\n\t\t *\r\n\t\t * The `cached` data structure is essentially the same as the previous\r\n\t\t * redraw's `data` data structure, with a few additions:\r\n\t\t * - `cached` always has a property called `nodes`, which is a list of\r\n\t\t *    DOM elements that correspond to the data represented by the\r\n\t\t *    respective virtual element\r\n\t\t * - in order to support attaching `nodes` as a property of `cached`,\r\n\t\t *    `cached` is *always* a non-primitive object, i.e. if the data was\r\n\t\t *    a string, then cached is a String instance. If data was `null` or\r\n\t\t *    `undefined`, cached is `new String(\"\")`\r\n\t\t * - `cached also has a `configContext` property, which is the state\r\n\t\t *    storage object exposed by config(element, isInitialized, context)\r\n\t\t * - when `cached` is an Object, it represents a virtual element; when\r\n\t\t *    it's an Array, it represents a list of elements; when it's a\r\n\t\t *    String, Number or Boolean, it represents a text node\r\n\t\t *\r\n\t\t * `parentElement` is a DOM element used for W3C DOM API calls\r\n\t\t * `parentTag` is only used for handling a corner case for textarea\r\n\t\t * values\r\n\t\t * `parentCache` is used to remove nodes in some multi-node cases\r\n\t\t * `parentIndex` and `index` are used to figure out the offset of nodes.\r\n\t\t * They're artifacts from before arrays started being flattened and are\r\n\t\t * likely refactorable\r\n\t\t * `data` and `cached` are, respectively, the new and old nodes being\r\n\t\t * diffed\r\n\t\t * `shouldReattach` is a flag indicating whether a parent node was\r\n\t\t * recreated (if so, and if this node is reused, then this node must\r\n\t\t * reattach itself to the new parent)\r\n\t\t * `editable` is a flag that indicates whether an ancestor is\r\n\t\t * contenteditable\r\n\t\t * `namespace` indicates the closest HTML namespace as it cascades down\r\n\t\t * from an ancestor\r\n\t\t * `configs` is a list of config functions to run after the topmost\r\n\t\t * `build` call finishes running\r\n\t\t *\r\n\t\t * there's logic that relies on the assumption that null and undefined\r\n\t\t * data are equivalent to empty strings\r\n\t\t * - this prevents lifecycle surprises from procedural helpers that mix\r\n\t\t *   implicit and explicit return statements (e.g.\r\n\t\t *   function foo() {if (cond) return m(\"div\")}\r\n\t\t * - it simplifies diffing code\r\n\t\t */\r\n\t\tdata = dataToString(data)\r\n\t\tif (data.subtree === \"retain\") return cached\r\n\t\tcached = makeCache(data, cached, index, parentIndex, parentCache)\r\n\r\n\t\tif (isArray(data)) {\r\n\t\t\treturn buildArray(\r\n\t\t\t\tdata,\r\n\t\t\t\tcached,\r\n\t\t\t\tparentElement,\r\n\t\t\t\tindex,\r\n\t\t\t\tparentTag,\r\n\t\t\t\tshouldReattach,\r\n\t\t\t\teditable,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tconfigs)\r\n\t\t} else if (data != null && isObject(data)) {\r\n\t\t\treturn buildObject(\r\n\t\t\t\tdata,\r\n\t\t\t\tcached,\r\n\t\t\t\teditable,\r\n\t\t\t\tparentElement,\r\n\t\t\t\tindex,\r\n\t\t\t\tshouldReattach,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tconfigs)\r\n\t\t} else if (!isFunction(data)) {\r\n\t\t\treturn handleTextNode(\r\n\t\t\t\tcached,\r\n\t\t\t\tdata,\r\n\t\t\t\tindex,\r\n\t\t\t\tparentElement,\r\n\t\t\t\tshouldReattach,\r\n\t\t\t\teditable,\r\n\t\t\t\tparentTag)\r\n\t\t} else {\r\n\t\t\treturn cached\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sortChanges(a, b) {\r\n\t\treturn a.action - b.action || a.index - b.index\r\n\t}\r\n\r\n\tfunction copyStyleAttrs(node, dataAttr, cachedAttr) {\r\n\t\tfor (var rule in dataAttr) {\r\n\t\t\tif (hasOwn.call(dataAttr, rule)) {\r\n\t\t\t\tif (cachedAttr == null || cachedAttr[rule] !== dataAttr[rule]) {\r\n\t\t\t\t\tnode.style[rule] = dataAttr[rule]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (rule in cachedAttr) {\r\n\t\t\tif (hasOwn.call(cachedAttr, rule)) {\r\n\t\t\t\tif (!hasOwn.call(dataAttr, rule)) node.style[rule] = \"\"\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar shouldUseSetAttribute = {\r\n\t\tlist: 1,\r\n\t\tstyle: 1,\r\n\t\tform: 1,\r\n\t\ttype: 1,\r\n\t\twidth: 1,\r\n\t\theight: 1\r\n\t}\r\n\r\n\tfunction setSingleAttr(\r\n\t\tnode,\r\n\t\tattrName,\r\n\t\tdataAttr,\r\n\t\tcachedAttr,\r\n\t\ttag,\r\n\t\tnamespace\r\n\t) {\r\n\t\tif (attrName === \"config\" || attrName === \"key\") {\r\n\t\t\t// `config` isn't a real attribute, so ignore it\r\n\t\t\treturn true\r\n\t\t} else if (isFunction(dataAttr) && attrName.slice(0, 2) === \"on\") {\r\n\t\t\t// hook event handlers to the auto-redrawing system\r\n\t\t\tnode[attrName] = autoredraw(dataAttr, node)\r\n\t\t} else if (attrName === \"style\" && dataAttr != null &&\r\n\t\t\t\tisObject(dataAttr)) {\r\n\t\t\t// handle `style: {...}`\r\n\t\t\tcopyStyleAttrs(node, dataAttr, cachedAttr)\r\n\t\t} else if (namespace != null) {\r\n\t\t\t// handle SVG\r\n\t\t\tif (attrName === \"href\") {\r\n\t\t\t\tnode.setAttributeNS(\"http://www.w3.org/1999/xlink\",\r\n\t\t\t\t\t\"href\", dataAttr)\r\n\t\t\t} else {\r\n\t\t\t\tnode.setAttribute(\r\n\t\t\t\t\tattrName === \"className\" ? \"class\" : attrName,\r\n\t\t\t\t\tdataAttr)\r\n\t\t\t}\r\n\t\t} else if (attrName in node && !shouldUseSetAttribute[attrName]) {\r\n\t\t\t// handle cases that are properties (but ignore cases where we\r\n\t\t\t// should use setAttribute instead)\r\n\t\t\t//\r\n\t\t\t// - list and form are typically used as strings, but are DOM\r\n\t\t\t//   element references in js\r\n\t\t\t//\r\n\t\t\t// - when using CSS selectors (e.g. `m(\"[style='']\")`), style is\r\n\t\t\t//   used as a string, but it's an object in js\r\n\t\t\t//\r\n\t\t\t// #348 don't set the value if not needed - otherwise, cursor\r\n\t\t\t// placement breaks in Chrome\r\n\t\t\ttry {\r\n\t\t\t\tif (tag !== \"input\" || node[attrName] !== dataAttr) {\r\n\t\t\t\t\tnode[attrName] = dataAttr\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tnode.setAttribute(attrName, dataAttr)\r\n\t\t\t}\r\n\t\t}\r\n\t\telse node.setAttribute(attrName, dataAttr)\r\n\t}\r\n\r\n\tfunction trySetAttr(\r\n\t\tnode,\r\n\t\tattrName,\r\n\t\tdataAttr,\r\n\t\tcachedAttr,\r\n\t\tcachedAttrs,\r\n\t\ttag,\r\n\t\tnamespace\r\n\t) {\r\n\t\tif (!(attrName in cachedAttrs) || (cachedAttr !== dataAttr) || ($document.activeElement === node)) {\r\n\t\t\tcachedAttrs[attrName] = dataAttr\r\n\t\t\ttry {\r\n\t\t\t\treturn setSingleAttr(\r\n\t\t\t\t\tnode,\r\n\t\t\t\t\tattrName,\r\n\t\t\t\t\tdataAttr,\r\n\t\t\t\t\tcachedAttr,\r\n\t\t\t\t\ttag,\r\n\t\t\t\t\tnamespace)\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// swallow IE's invalid argument errors to mimic HTML's\r\n\t\t\t\t// fallback-to-doing-nothing-on-invalid-attributes behavior\r\n\t\t\t\tif (e.message.indexOf(\"Invalid argument\") < 0) throw e\r\n\t\t\t}\r\n\t\t} else if (attrName === \"value\" && tag === \"input\" &&\r\n\t\t\t\tnode.value !== dataAttr) {\r\n\t\t\t// #348 dataAttr may not be a string, so use loose comparison\r\n\t\t\tnode.value = dataAttr\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setAttributes(node, tag, dataAttrs, cachedAttrs, namespace) {\r\n\t\tfor (var attrName in dataAttrs) {\r\n\t\t\tif (hasOwn.call(dataAttrs, attrName)) {\r\n\t\t\t\tif (trySetAttr(\r\n\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\tattrName,\r\n\t\t\t\t\t\tdataAttrs[attrName],\r\n\t\t\t\t\t\tcachedAttrs[attrName],\r\n\t\t\t\t\t\tcachedAttrs,\r\n\t\t\t\t\t\ttag,\r\n\t\t\t\t\t\tnamespace)) {\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn cachedAttrs\r\n\t}\r\n\r\n\tfunction clear(nodes, cached) {\r\n\t\tfor (var i = nodes.length - 1; i > -1; i--) {\r\n\t\t\tif (nodes[i] && nodes[i].parentNode) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tnodes[i].parentNode.removeChild(nodes[i])\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t/* eslint-disable max-len */\r\n\t\t\t\t\t// ignore if this fails due to order of events (see\r\n\t\t\t\t\t// http://stackoverflow.com/questions/21926083/failed-to-execute-removechild-on-node)\r\n\t\t\t\t\t/* eslint-enable max-len */\r\n\t\t\t\t}\r\n\t\t\t\tcached = [].concat(cached)\r\n\t\t\t\tif (cached[i]) unload(cached[i])\r\n\t\t\t}\r\n\t\t}\r\n\t\t// release memory if nodes is an array. This check should fail if nodes\r\n\t\t// is a NodeList (see loop above)\r\n\t\tif (nodes.length) {\r\n\t\t\tnodes.length = 0\r\n\t\t}\r\n\t}\r\n\r\n\tfunction unload(cached) {\r\n\t\tif (cached.configContext && isFunction(cached.configContext.onunload)) {\r\n\t\t\tcached.configContext.onunload()\r\n\t\t\tcached.configContext.onunload = null\r\n\t\t}\r\n\t\tif (cached.controllers) {\r\n\t\t\tforEach(cached.controllers, function (controller) {\r\n\t\t\t\tif (isFunction(controller.onunload)) {\r\n\t\t\t\t\tcontroller.onunload({preventDefault: noop})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (cached.children) {\r\n\t\t\tif (isArray(cached.children)) forEach(cached.children, unload)\r\n\t\t\telse if (cached.children.tag) unload(cached.children)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction appendTextFragment(parentElement, data) {\r\n\t\ttry {\r\n\t\t\tparentElement.appendChild(\r\n\t\t\t\t$document.createRange().createContextualFragment(data))\r\n\t\t} catch (e) {\r\n\t\t\tparentElement.insertAdjacentHTML(\"beforeend\", data)\r\n\t\t\treplaceScriptNodes(parentElement)\r\n\t\t}\r\n\t}\r\n\r\n\t// Replace script tags inside given DOM element with executable ones.\r\n\t// Will also check children recursively and replace any found script\r\n\t// tags in same manner.\r\n\tfunction replaceScriptNodes(node) {\r\n\t\tif (node.tagName === \"SCRIPT\") {\r\n\t\t\tnode.parentNode.replaceChild(buildExecutableNode(node), node)\r\n\t\t} else {\r\n\t\t\tvar children = node.childNodes\r\n\t\t\tif (children && children.length) {\r\n\t\t\t\tfor (var i = 0; i < children.length; i++) {\r\n\t\t\t\t\treplaceScriptNodes(children[i])\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn node\r\n\t}\r\n\r\n\t// Replace script element with one whose contents are executable.\r\n\tfunction buildExecutableNode(node){\r\n\t\tvar scriptEl = document.createElement(\"script\")\r\n\t\tvar attrs = node.attributes\r\n\r\n\t\tfor (var i = 0; i < attrs.length; i++) {\r\n\t\t\tscriptEl.setAttribute(attrs[i].name, attrs[i].value)\r\n\t\t}\r\n\r\n\t\tscriptEl.text = node.innerHTML\r\n\t\treturn scriptEl\r\n\t}\r\n\r\n\tfunction injectHTML(parentElement, index, data) {\r\n\t\tvar nextSibling = parentElement.childNodes[index]\r\n\t\tif (nextSibling) {\r\n\t\t\tvar isElement = nextSibling.nodeType !== 1\r\n\t\t\tvar placeholder = $document.createElement(\"span\")\r\n\t\t\tif (isElement) {\r\n\t\t\t\tparentElement.insertBefore(placeholder, nextSibling || null)\r\n\t\t\t\tplaceholder.insertAdjacentHTML(\"beforebegin\", data)\r\n\t\t\t\tparentElement.removeChild(placeholder)\r\n\t\t\t} else {\r\n\t\t\t\tnextSibling.insertAdjacentHTML(\"beforebegin\", data)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tappendTextFragment(parentElement, data)\r\n\t\t}\r\n\r\n\t\tvar nodes = []\r\n\r\n\t\twhile (parentElement.childNodes[index] !== nextSibling) {\r\n\t\t\tnodes.push(parentElement.childNodes[index])\r\n\t\t\tindex++\r\n\t\t}\r\n\r\n\t\treturn nodes\r\n\t}\r\n\r\n\tfunction autoredraw(callback, object) {\r\n\t\treturn function (e) {\r\n\t\t\te = e || event\r\n\t\t\tm.redraw.strategy(\"diff\")\r\n\t\t\tm.startComputation()\r\n\t\t\ttry {\r\n\t\t\t\treturn callback.call(object, e)\r\n\t\t\t} finally {\r\n\t\t\t\tendFirstComputation()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar html\r\n\tvar documentNode = {\r\n\t\tappendChild: function (node) {\r\n\t\t\tif (html === undefined) html = $document.createElement(\"html\")\r\n\t\t\tif ($document.documentElement &&\r\n\t\t\t\t\t$document.documentElement !== node) {\r\n\t\t\t\t$document.replaceChild(node, $document.documentElement)\r\n\t\t\t} else {\r\n\t\t\t\t$document.appendChild(node)\r\n\t\t\t}\r\n\r\n\t\t\tthis.childNodes = $document.childNodes\r\n\t\t},\r\n\r\n\t\tinsertBefore: function (node) {\r\n\t\t\tthis.appendChild(node)\r\n\t\t},\r\n\r\n\t\tchildNodes: []\r\n\t}\r\n\r\n\tvar nodeCache = []\r\n\tvar cellCache = {}\r\n\r\n\tm.render = function (root, cell, forceRecreation) {\r\n\t\tif (!root) {\r\n\t\t\tthrow new Error(\"Ensure the DOM element being passed to \" +\r\n\t\t\t\t\"m.route/m.mount/m.render is not undefined.\")\r\n\t\t}\r\n\t\tvar configs = []\r\n\t\tvar id = getCellCacheKey(root)\r\n\t\tvar isDocumentRoot = root === $document\r\n\t\tvar node\r\n\r\n\t\tif (isDocumentRoot || root === $document.documentElement) {\r\n\t\t\tnode = documentNode\r\n\t\t} else {\r\n\t\t\tnode = root\r\n\t\t}\r\n\r\n\t\tif (isDocumentRoot && cell.tag !== \"html\") {\r\n\t\t\tcell = {tag: \"html\", attrs: {}, children: cell}\r\n\t\t}\r\n\r\n\t\tif (cellCache[id] === undefined) clear(node.childNodes)\r\n\t\tif (forceRecreation === true) reset(root)\r\n\r\n\t\tcellCache[id] = build(\r\n\t\t\tnode,\r\n\t\t\tnull,\r\n\t\t\tundefined,\r\n\t\t\tundefined,\r\n\t\t\tcell,\r\n\t\t\tcellCache[id],\r\n\t\t\tfalse,\r\n\t\t\t0,\r\n\t\t\tnull,\r\n\t\t\tundefined,\r\n\t\t\tconfigs)\r\n\r\n\t\tforEach(configs, function (config) { config() })\r\n\t}\r\n\r\n\tfunction getCellCacheKey(element) {\r\n\t\tvar index = nodeCache.indexOf(element)\r\n\t\treturn index < 0 ? nodeCache.push(element) - 1 : index\r\n\t}\r\n\r\n\tm.trust = function (value) {\r\n\t\tvalue = new String(value) // eslint-disable-line no-new-wrappers\r\n\t\tvalue.$trusted = true\r\n\t\treturn value\r\n\t}\r\n\r\n\tfunction gettersetter(store) {\r\n\t\tfunction prop() {\r\n\t\t\tif (arguments.length) store = arguments[0]\r\n\t\t\treturn store\r\n\t\t}\r\n\r\n\t\tprop.toJSON = function () {\r\n\t\t\treturn store\r\n\t\t}\r\n\r\n\t\treturn prop\r\n\t}\r\n\r\n\tm.prop = function (store) {\r\n\t\tif ((store != null && (isObject(store) || isFunction(store)) || ((typeof Promise !== \"undefined\") && (store instanceof Promise))) &&\r\n\t\t\t\tisFunction(store.then)) {\r\n\t\t\treturn propify(store)\r\n\t\t}\r\n\r\n\t\treturn gettersetter(store)\r\n\t}\r\n\r\n\tvar roots = []\r\n\tvar components = []\r\n\tvar controllers = []\r\n\tvar lastRedrawId = null\r\n\tvar lastRedrawCallTime = 0\r\n\tvar computePreRedrawHook = null\r\n\tvar computePostRedrawHook = null\r\n\tvar topComponent\r\n\tvar FRAME_BUDGET = 16 // 60 frames per second = 1 call per 16 ms\r\n\r\n\tfunction parameterize(component, args) {\r\n\t\tfunction controller() {\r\n\t\t\t/* eslint-disable no-invalid-this */\r\n\t\t\treturn (component.controller || noop).apply(this, args) || this\r\n\t\t\t/* eslint-enable no-invalid-this */\r\n\t\t}\r\n\r\n\t\tif (component.controller) {\r\n\t\t\tcontroller.prototype = component.controller.prototype\r\n\t\t}\r\n\r\n\t\tfunction view(ctrl) {\r\n\t\t\tvar currentArgs = [ctrl].concat(args)\r\n\t\t\tfor (var i = 1; i < arguments.length; i++) {\r\n\t\t\t\tcurrentArgs.push(arguments[i])\r\n\t\t\t}\r\n\r\n\t\t\treturn component.view.apply(component, currentArgs)\r\n\t\t}\r\n\r\n\t\tview.$original = component.view\r\n\t\tvar output = {controller: controller, view: view}\r\n\t\tif (args[0] && args[0].key != null) output.attrs = {key: args[0].key}\r\n\t\treturn output\r\n\t}\r\n\r\n\tm.component = function (component) {\r\n\t\tvar args = new Array(arguments.length - 1)\r\n\r\n\t\tfor (var i = 1; i < arguments.length; i++) {\r\n\t\t\targs[i - 1] = arguments[i]\r\n\t\t}\r\n\r\n\t\treturn parameterize(component, args)\r\n\t}\r\n\r\n\tfunction checkPrevented(component, root, index, isPrevented) {\r\n\t\tif (!isPrevented) {\r\n\t\t\tm.redraw.strategy(\"all\")\r\n\t\t\tm.startComputation()\r\n\t\t\troots[index] = root\r\n\t\t\tvar currentComponent\r\n\r\n\t\t\tif (component) {\r\n\t\t\t\tcurrentComponent = topComponent = component\r\n\t\t\t} else {\r\n\t\t\t\tcurrentComponent = topComponent = component = {controller: noop}\r\n\t\t\t}\r\n\r\n\t\t\tvar controller = new (component.controller || noop)()\r\n\r\n\t\t\t// controllers may call m.mount recursively (via m.route redirects,\r\n\t\t\t// for example)\r\n\t\t\t// this conditional ensures only the last recursive m.mount call is\r\n\t\t\t// applied\r\n\t\t\tif (currentComponent === topComponent) {\r\n\t\t\t\tcontrollers[index] = controller\r\n\t\t\t\tcomponents[index] = component\r\n\t\t\t}\r\n\t\t\tendFirstComputation()\r\n\t\t\tif (component === null) {\r\n\t\t\t\tremoveRootElement(root, index)\r\n\t\t\t}\r\n\t\t\treturn controllers[index]\r\n\t\t} else if (component == null) {\r\n\t\t\tremoveRootElement(root, index)\r\n\t\t}\r\n\t}\r\n\r\n\tm.mount = m.module = function (root, component) {\r\n\t\tif (!root) {\r\n\t\t\tthrow new Error(\"Please ensure the DOM element exists before \" +\r\n\t\t\t\t\"rendering a template into it.\")\r\n\t\t}\r\n\r\n\t\tvar index = roots.indexOf(root)\r\n\t\tif (index < 0) index = roots.length\r\n\r\n\t\tvar isPrevented = false\r\n\t\tvar event = {\r\n\t\t\tpreventDefault: function () {\r\n\t\t\t\tisPrevented = true\r\n\t\t\t\tcomputePreRedrawHook = computePostRedrawHook = null\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tforEach(unloaders, function (unloader) {\r\n\t\t\tunloader.handler.call(unloader.controller, event)\r\n\t\t\tunloader.controller.onunload = null\r\n\t\t})\r\n\r\n\t\tif (isPrevented) {\r\n\t\t\tforEach(unloaders, function (unloader) {\r\n\t\t\t\tunloader.controller.onunload = unloader.handler\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tunloaders = []\r\n\t\t}\r\n\r\n\t\tif (controllers[index] && isFunction(controllers[index].onunload)) {\r\n\t\t\tcontrollers[index].onunload(event)\r\n\t\t}\r\n\r\n\t\treturn checkPrevented(component, root, index, isPrevented)\r\n\t}\r\n\r\n\tfunction removeRootElement(root, index) {\r\n\t\troots.splice(index, 1)\r\n\t\tcontrollers.splice(index, 1)\r\n\t\tcomponents.splice(index, 1)\r\n\t\treset(root)\r\n\t\tnodeCache.splice(getCellCacheKey(root), 1)\r\n\t}\r\n\r\n\tvar redrawing = false\r\n\tm.redraw = function (force) {\r\n\t\tif (redrawing) return\r\n\t\tredrawing = true\r\n\t\tif (force) forcing = true\r\n\r\n\t\ttry {\r\n\t\t\t// lastRedrawId is a positive number if a second redraw is requested\r\n\t\t\t// before the next animation frame\r\n\t\t\t// lastRedrawId is null if it's the first redraw and not an event\r\n\t\t\t// handler\r\n\t\t\tif (lastRedrawId && !force) {\r\n\t\t\t\t// when setTimeout: only reschedule redraw if time between now\r\n\t\t\t\t// and previous redraw is bigger than a frame, otherwise keep\r\n\t\t\t\t// currently scheduled timeout\r\n\t\t\t\t// when rAF: always reschedule redraw\r\n\t\t\t\tif ($requestAnimationFrame === global.requestAnimationFrame ||\r\n\t\t\t\t\t\tnew Date() - lastRedrawCallTime > FRAME_BUDGET) {\r\n\t\t\t\t\tif (lastRedrawId > 0) $cancelAnimationFrame(lastRedrawId)\r\n\t\t\t\t\tlastRedrawId = $requestAnimationFrame(redraw, FRAME_BUDGET)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tredraw()\r\n\t\t\t\tlastRedrawId = $requestAnimationFrame(function () {\r\n\t\t\t\t\tlastRedrawId = null\r\n\t\t\t\t}, FRAME_BUDGET)\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tredrawing = forcing = false\r\n\t\t}\r\n\t}\r\n\r\n\tm.redraw.strategy = m.prop()\r\n\tfunction redraw() {\r\n\t\tif (computePreRedrawHook) {\r\n\t\t\tcomputePreRedrawHook()\r\n\t\t\tcomputePreRedrawHook = null\r\n\t\t}\r\n\t\tforEach(roots, function (root, i) {\r\n\t\t\tvar component = components[i]\r\n\t\t\tif (controllers[i]) {\r\n\t\t\t\tvar args = [controllers[i]]\r\n\t\t\t\tm.render(root,\r\n\t\t\t\t\tcomponent.view ? component.view(controllers[i], args) : \"\")\r\n\t\t\t}\r\n\t\t})\r\n\t\t// after rendering within a routed context, we need to scroll back to\r\n\t\t// the top, and fetch the document title for history.pushState\r\n\t\tif (computePostRedrawHook) {\r\n\t\t\tcomputePostRedrawHook()\r\n\t\t\tcomputePostRedrawHook = null\r\n\t\t}\r\n\t\tlastRedrawId = null\r\n\t\tlastRedrawCallTime = new Date()\r\n\t\tm.redraw.strategy(\"diff\")\r\n\t}\r\n\r\n\tfunction endFirstComputation() {\r\n\t\tif (m.redraw.strategy() === \"none\") {\r\n\t\t\tpendingRequests--\r\n\t\t\tm.redraw.strategy(\"diff\")\r\n\t\t} else {\r\n\t\t\tm.endComputation()\r\n\t\t}\r\n\t}\r\n\r\n\tm.withAttr = function (prop, withAttrCallback, callbackThis) {\r\n\t\treturn function (e) {\r\n\t\t\te = e || window.event\r\n\t\t\t/* eslint-disable no-invalid-this */\r\n\t\t\tvar currentTarget = e.currentTarget || this\r\n\t\t\tvar _this = callbackThis || this\r\n\t\t\t/* eslint-enable no-invalid-this */\r\n\t\t\tvar target = prop in currentTarget ?\r\n\t\t\t\tcurrentTarget[prop] :\r\n\t\t\t\tcurrentTarget.getAttribute(prop)\r\n\t\t\twithAttrCallback.call(_this, target)\r\n\t\t}\r\n\t}\r\n\r\n\t// routing\r\n\tvar modes = {pathname: \"\", hash: \"#\", search: \"?\"}\r\n\tvar redirect = noop\r\n\tvar isDefaultRoute = false\r\n\tvar routeParams, currentRoute\r\n\r\n\tm.route = function (root, arg1, arg2, vdom) { // eslint-disable-line\r\n\t\t// m.route()\r\n\t\tif (arguments.length === 0) return currentRoute\r\n\t\t// m.route(el, defaultRoute, routes)\r\n\t\tif (arguments.length === 3 && isString(arg1)) {\r\n\t\t\tredirect = function (source) {\r\n\t\t\t\tvar path = currentRoute = normalizeRoute(source)\r\n\t\t\t\tif (!routeByValue(root, arg2, path)) {\r\n\t\t\t\t\tif (isDefaultRoute) {\r\n\t\t\t\t\t\tthrow new Error(\"Ensure the default route matches \" +\r\n\t\t\t\t\t\t\t\"one of the routes defined in m.route\")\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tisDefaultRoute = true\r\n\t\t\t\t\tm.route(arg1, true)\r\n\t\t\t\t\tisDefaultRoute = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar listener = m.route.mode === \"hash\" ?\r\n\t\t\t\t\"onhashchange\" :\r\n\t\t\t\t\"onpopstate\"\r\n\r\n\t\t\tglobal[listener] = function () {\r\n\t\t\t\tvar path = $location[m.route.mode]\r\n\t\t\t\tif (m.route.mode === \"pathname\") path += $location.search\r\n\t\t\t\tif (currentRoute !== normalizeRoute(path)) redirect(path)\r\n\t\t\t}\r\n\r\n\t\t\tcomputePreRedrawHook = setScroll\r\n\t\t\tglobal[listener]()\r\n\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// config: m.route\r\n\t\tif (root.addEventListener || root.attachEvent) {\r\n\t\t\tvar base = m.route.mode !== \"pathname\" ? $location.pathname : \"\"\r\n\t\t\troot.href = base + modes[m.route.mode] + vdom.attrs.href\r\n\t\t\tif (root.addEventListener) {\r\n\t\t\t\troot.removeEventListener(\"click\", routeUnobtrusive)\r\n\t\t\t\troot.addEventListener(\"click\", routeUnobtrusive)\r\n\t\t\t} else {\r\n\t\t\t\troot.detachEvent(\"onclick\", routeUnobtrusive)\r\n\t\t\t\troot.attachEvent(\"onclick\", routeUnobtrusive)\r\n\t\t\t}\r\n\r\n\t\t\treturn\r\n\t\t}\r\n\t\t// m.route(route, params, shouldReplaceHistoryEntry)\r\n\t\tif (isString(root)) {\r\n\t\t\tvar oldRoute = currentRoute\r\n\t\t\tcurrentRoute = root\r\n\r\n\t\t\tvar args = arg1 || {}\r\n\t\t\tvar queryIndex = currentRoute.indexOf(\"?\")\r\n\t\t\tvar params\r\n\r\n\t\t\tif (queryIndex > -1) {\r\n\t\t\t\tparams = parseQueryString(currentRoute.slice(queryIndex + 1))\r\n\t\t\t} else {\r\n\t\t\t\tparams = {}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i in args) {\r\n\t\t\t\tif (hasOwn.call(args, i)) {\r\n\t\t\t\t\tparams[i] = args[i]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar querystring = buildQueryString(params)\r\n\t\t\tvar currentPath\r\n\r\n\t\t\tif (queryIndex > -1) {\r\n\t\t\t\tcurrentPath = currentRoute.slice(0, queryIndex)\r\n\t\t\t} else {\r\n\t\t\t\tcurrentPath = currentRoute\r\n\t\t\t}\r\n\r\n\t\t\tif (querystring) {\r\n\t\t\t\tcurrentRoute = currentPath +\r\n\t\t\t\t\t(currentPath.indexOf(\"?\") === -1 ? \"?\" : \"&\") +\r\n\t\t\t\t\tquerystring\r\n\t\t\t}\r\n\r\n\t\t\tvar replaceHistory =\r\n\t\t\t\t(arguments.length === 3 ? arg2 : arg1) === true ||\r\n\t\t\t\toldRoute === root\r\n\r\n\t\t\tif (global.history.pushState) {\r\n\t\t\t\tvar method = replaceHistory ? \"replaceState\" : \"pushState\"\r\n\t\t\t\tcomputePreRedrawHook = setScroll\r\n\t\t\t\tcomputePostRedrawHook = function () {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tglobal.history[method](null, $document.title,\r\n\t\t\t\t\t\t\tmodes[m.route.mode] + currentRoute)\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t// In the event of a pushState or replaceState failure,\r\n\t\t\t\t\t\t// fallback to a standard redirect. This is specifically\r\n\t\t\t\t\t\t// to address a Safari security error when attempting to\r\n\t\t\t\t\t\t// call pushState more than 100 times.\r\n\t\t\t\t\t\t$location[m.route.mode] = currentRoute\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tredirect(modes[m.route.mode] + currentRoute)\r\n\t\t\t} else {\r\n\t\t\t\t$location[m.route.mode] = currentRoute\r\n\t\t\t\tredirect(modes[m.route.mode] + currentRoute)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tm.route.param = function (key) {\r\n\t\tif (!routeParams) {\r\n\t\t\tthrow new Error(\"You must call m.route(element, defaultRoute, \" +\r\n\t\t\t\t\"routes) before calling m.route.param()\")\r\n\t\t}\r\n\r\n\t\tif (!key) {\r\n\t\t\treturn routeParams\r\n\t\t}\r\n\r\n\t\treturn routeParams[key]\r\n\t}\r\n\r\n\tm.route.mode = \"search\"\r\n\r\n\tfunction normalizeRoute(route) {\r\n\t\treturn route.slice(modes[m.route.mode].length)\r\n\t}\r\n\r\n\tfunction routeByValue(root, router, path) {\r\n\t\trouteParams = {}\r\n\r\n\t\tvar queryStart = path.indexOf(\"?\")\r\n\t\tif (queryStart !== -1) {\r\n\t\t\trouteParams = parseQueryString(\r\n\t\t\t\tpath.substr(queryStart + 1, path.length))\r\n\t\t\tpath = path.substr(0, queryStart)\r\n\t\t}\r\n\r\n\t\t// Get all routes and check if there's\r\n\t\t// an exact match for the current path\r\n\t\tvar keys = Object.keys(router)\r\n\t\tvar index = keys.indexOf(path)\r\n\r\n\t\tif (index !== -1){\r\n\t\t\tm.mount(root, router[keys [index]])\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tfor (var route in router) {\r\n\t\t\tif (hasOwn.call(router, route)) {\r\n\t\t\t\tif (route === path) {\r\n\t\t\t\t\tm.mount(root, router[route])\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar matcher = new RegExp(\"^\" + route\r\n\t\t\t\t\t.replace(/:[^\\/]+?\\.{3}/g, \"(.*?)\")\r\n\t\t\t\t\t.replace(/:[^\\/]+/g, \"([^\\\\/]+)\") + \"\\/?$\")\r\n\r\n\t\t\t\tif (matcher.test(path)) {\r\n\t\t\t\t\t/* eslint-disable no-loop-func */\r\n\t\t\t\t\tpath.replace(matcher, function () {\r\n\t\t\t\t\t\tvar keys = route.match(/:[^\\/]+/g) || []\r\n\t\t\t\t\t\tvar values = [].slice.call(arguments, 1, -2)\r\n\t\t\t\t\t\tforEach(keys, function (key, i) {\r\n\t\t\t\t\t\t\trouteParams[key.replace(/:|\\./g, \"\")] =\r\n\t\t\t\t\t\t\t\tdecodeURIComponent(values[i])\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tm.mount(root, router[route])\r\n\t\t\t\t\t})\r\n\t\t\t\t\t/* eslint-enable no-loop-func */\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction routeUnobtrusive(e) {\r\n\t\te = e || event\r\n\t\tif (e.ctrlKey || e.metaKey || e.shiftKey || e.which === 2) return\r\n\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault()\r\n\t\t} else {\r\n\t\t\te.returnValue = false\r\n\t\t}\r\n\r\n\t\tvar currentTarget = e.currentTarget || e.srcElement\r\n\t\tvar args\r\n\r\n\t\tif (m.route.mode === \"pathname\" && currentTarget.search) {\r\n\t\t\targs = parseQueryString(currentTarget.search.slice(1))\r\n\t\t} else {\r\n\t\t\targs = {}\r\n\t\t}\r\n\r\n\t\twhile (currentTarget && !/a/i.test(currentTarget.nodeName)) {\r\n\t\t\tcurrentTarget = currentTarget.parentNode\r\n\t\t}\r\n\r\n\t\t// clear pendingRequests because we want an immediate route change\r\n\t\tpendingRequests = 0\r\n\t\tm.route(currentTarget[m.route.mode]\r\n\t\t\t.slice(modes[m.route.mode].length), args)\r\n\t}\r\n\r\n\tfunction setScroll() {\r\n\t\tif (m.route.mode !== \"hash\" && $location.hash) {\r\n\t\t\t$location.hash = $location.hash\r\n\t\t} else {\r\n\t\t\tglobal.scrollTo(0, 0)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction buildQueryString(object, prefix) {\r\n\t\tvar duplicates = {}\r\n\t\tvar str = []\r\n\r\n\t\tfor (var prop in object) {\r\n\t\t\tif (hasOwn.call(object, prop)) {\r\n\t\t\t\tvar key = prefix ? prefix + \"[\" + prop + \"]\" : prop\r\n\t\t\t\tvar value = object[prop]\r\n\r\n\t\t\t\tif (value === null) {\r\n\t\t\t\t\tstr.push(encodeURIComponent(key))\r\n\t\t\t\t} else if (isObject(value)) {\r\n\t\t\t\t\tstr.push(buildQueryString(value, key))\r\n\t\t\t\t} else if (isArray(value)) {\r\n\t\t\t\t\tvar keys = []\r\n\t\t\t\t\tduplicates[key] = duplicates[key] || {}\r\n\t\t\t\t\t/* eslint-disable no-loop-func */\r\n\t\t\t\t\tforEach(value, function (item) {\r\n\t\t\t\t\t\t/* eslint-enable no-loop-func */\r\n\t\t\t\t\t\tif (!duplicates[key][item]) {\r\n\t\t\t\t\t\t\tduplicates[key][item] = true\r\n\t\t\t\t\t\t\tkeys.push(encodeURIComponent(key) + \"=\" +\r\n\t\t\t\t\t\t\t\tencodeURIComponent(item))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tstr.push(keys.join(\"&\"))\r\n\t\t\t\t} else if (value !== undefined) {\r\n\t\t\t\t\tstr.push(encodeURIComponent(key) + \"=\" +\r\n\t\t\t\t\t\tencodeURIComponent(value))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn str.join(\"&\")\r\n\t}\r\n\r\n\tfunction parseQueryString(str) {\r\n\t\tif (str === \"\" || str == null) return {}\r\n\t\tif (str.charAt(0) === \"?\") str = str.slice(1)\r\n\r\n\t\tvar pairs = str.split(\"&\")\r\n\t\tvar params = {}\r\n\r\n\t\tforEach(pairs, function (string) {\r\n\t\t\tvar pair = string.split(\"=\")\r\n\t\t\tvar key = decodeURIComponent(pair[0])\r\n\t\t\tvar value = pair.length === 2 ? decodeURIComponent(pair[1]) : null\r\n\t\t\tif (params[key] != null) {\r\n\t\t\t\tif (!isArray(params[key])) params[key] = [params[key]]\r\n\t\t\t\tparams[key].push(value)\r\n\t\t\t}\r\n\t\t\telse params[key] = value\r\n\t\t})\r\n\r\n\t\treturn params\r\n\t}\r\n\r\n\tm.route.buildQueryString = buildQueryString\r\n\tm.route.parseQueryString = parseQueryString\r\n\r\n\tfunction reset(root) {\r\n\t\tvar cacheKey = getCellCacheKey(root)\r\n\t\tclear(root.childNodes, cellCache[cacheKey])\r\n\t\tcellCache[cacheKey] = undefined\r\n\t}\r\n\r\n\tm.deferred = function () {\r\n\t\tvar deferred = new Deferred()\r\n\t\tdeferred.promise = propify(deferred.promise)\r\n\t\treturn deferred\r\n\t}\r\n\r\n\tfunction propify(promise, initialValue) {\r\n\t\tvar prop = m.prop(initialValue)\r\n\t\tpromise.then(prop)\r\n\t\tprop.then = function (resolve, reject) {\r\n\t\t\treturn propify(promise.then(resolve, reject), initialValue)\r\n\t\t}\r\n\r\n\t\tprop.catch = prop.then.bind(null, null)\r\n\t\treturn prop\r\n\t}\r\n\t// Promiz.mithril.js | Zolmeister | MIT\r\n\t// a modified version of Promiz.js, which does not conform to Promises/A+\r\n\t// for two reasons:\r\n\t//\r\n\t// 1) `then` callbacks are called synchronously (because setTimeout is too\r\n\t//    slow, and the setImmediate polyfill is too big\r\n\t//\r\n\t// 2) throwing subclasses of Error cause the error to be bubbled up instead\r\n\t//    of triggering rejection (because the spec does not account for the\r\n\t//    important use case of default browser error handling, i.e. message w/\r\n\t//    line number)\r\n\r\n\tvar RESOLVING = 1\r\n\tvar REJECTING = 2\r\n\tvar RESOLVED = 3\r\n\tvar REJECTED = 4\r\n\r\n\tfunction Deferred(onSuccess, onFailure) {\r\n\t\tvar self = this\r\n\t\tvar state = 0\r\n\t\tvar promiseValue = 0\r\n\t\tvar next = []\r\n\r\n\t\tself.promise = {}\r\n\r\n\t\tself.resolve = function (value) {\r\n\t\t\tif (!state) {\r\n\t\t\t\tpromiseValue = value\r\n\t\t\t\tstate = RESOLVING\r\n\r\n\t\t\t\tfire()\r\n\t\t\t}\r\n\r\n\t\t\treturn self\r\n\t\t}\r\n\r\n\t\tself.reject = function (value) {\r\n\t\t\tif (!state) {\r\n\t\t\t\tpromiseValue = value\r\n\t\t\t\tstate = REJECTING\r\n\r\n\t\t\t\tfire()\r\n\t\t\t}\r\n\r\n\t\t\treturn self\r\n\t\t}\r\n\r\n\t\tself.promise.then = function (onSuccess, onFailure) {\r\n\t\t\tvar deferred = new Deferred(onSuccess, onFailure)\r\n\r\n\t\t\tif (state === RESOLVED) {\r\n\t\t\t\tdeferred.resolve(promiseValue)\r\n\t\t\t} else if (state === REJECTED) {\r\n\t\t\t\tdeferred.reject(promiseValue)\r\n\t\t\t} else {\r\n\t\t\t\tnext.push(deferred)\r\n\t\t\t}\r\n\r\n\t\t\treturn deferred.promise\r\n\t\t}\r\n\r\n\t\tfunction finish(type) {\r\n\t\t\tstate = type || REJECTED\r\n\t\t\tnext.map(function (deferred) {\r\n\t\t\t\tif (state === RESOLVED) {\r\n\t\t\t\t\tdeferred.resolve(promiseValue)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeferred.reject(promiseValue)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction thennable(then, success, failure, notThennable) {\r\n\t\t\tif (((promiseValue != null && isObject(promiseValue)) ||\r\n\t\t\t\t\tisFunction(promiseValue)) && isFunction(then)) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// count protects against abuse calls from spec checker\r\n\t\t\t\t\tvar count = 0\r\n\t\t\t\t\tthen.call(promiseValue, function (value) {\r\n\t\t\t\t\t\tif (count++) return\r\n\t\t\t\t\t\tpromiseValue = value\r\n\t\t\t\t\t\tsuccess()\r\n\t\t\t\t\t}, function (value) {\r\n\t\t\t\t\t\tif (count++) return\r\n\t\t\t\t\t\tpromiseValue = value\r\n\t\t\t\t\t\tfailure()\r\n\t\t\t\t\t})\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tm.deferred.onerror(e)\r\n\t\t\t\t\tpromiseValue = e\r\n\t\t\t\t\tfailure()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnotThennable()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction fire() {\r\n\t\t\t// check if it's a thenable\r\n\t\t\tvar then\r\n\t\t\ttry {\r\n\t\t\t\tthen = promiseValue && promiseValue.then\r\n\t\t\t} catch (e) {\r\n\t\t\t\tm.deferred.onerror(e)\r\n\t\t\t\tpromiseValue = e\r\n\t\t\t\tstate = REJECTING\r\n\t\t\t\treturn fire()\r\n\t\t\t}\r\n\r\n\t\t\tif (state === REJECTING) {\r\n\t\t\t\tm.deferred.onerror(promiseValue)\r\n\t\t\t}\r\n\r\n\t\t\tthennable(then, function () {\r\n\t\t\t\tstate = RESOLVING\r\n\t\t\t\tfire()\r\n\t\t\t}, function () {\r\n\t\t\t\tstate = REJECTING\r\n\t\t\t\tfire()\r\n\t\t\t}, function () {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (state === RESOLVING && isFunction(onSuccess)) {\r\n\t\t\t\t\t\tpromiseValue = onSuccess(promiseValue)\r\n\t\t\t\t\t} else if (state === REJECTING && isFunction(onFailure)) {\r\n\t\t\t\t\t\tpromiseValue = onFailure(promiseValue)\r\n\t\t\t\t\t\tstate = RESOLVING\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tm.deferred.onerror(e)\r\n\t\t\t\t\tpromiseValue = e\r\n\t\t\t\t\treturn finish()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (promiseValue === self) {\r\n\t\t\t\t\tpromiseValue = TypeError()\r\n\t\t\t\t\tfinish()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthennable(then, function () {\r\n\t\t\t\t\t\tfinish(RESOLVED)\r\n\t\t\t\t\t}, finish, function () {\r\n\t\t\t\t\t\tfinish(state === RESOLVING && RESOLVED)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tm.deferred.onerror = function (e) {\r\n\t\tif (type.call(e) === \"[object Error]\" &&\r\n\t\t\t\t!/ Error/.test(e.constructor.toString())) {\r\n\t\t\tpendingRequests = 0\r\n\t\t\tthrow e\r\n\t\t}\r\n\t}\r\n\r\n\tm.sync = function (args) {\r\n\t\tvar deferred = m.deferred()\r\n\t\tvar outstanding = args.length\r\n\t\tvar results = []\r\n\t\tvar method = \"resolve\"\r\n\r\n\t\tfunction synchronizer(pos, resolved) {\r\n\t\t\treturn function (value) {\r\n\t\t\t\tresults[pos] = value\r\n\t\t\t\tif (!resolved) method = \"reject\"\r\n\t\t\t\tif (--outstanding === 0) {\r\n\t\t\t\t\tdeferred.promise(results)\r\n\t\t\t\t\tdeferred[method](results)\r\n\t\t\t\t}\r\n\t\t\t\treturn value\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (args.length > 0) {\r\n\t\t\tforEach(args, function (arg, i) {\r\n\t\t\t\targ.then(synchronizer(i, true), synchronizer(i, false))\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tdeferred.resolve([])\r\n\t\t}\r\n\r\n\t\treturn deferred.promise\r\n\t}\r\n\r\n\tfunction identity(value) { return value }\r\n\r\n\tfunction handleJsonp(options) {\r\n\t\tvar callbackKey = options.callbackName || \"mithril_callback_\" +\r\n\t\t\tnew Date().getTime() + \"_\" +\r\n\t\t\t(Math.round(Math.random() * 1e16)).toString(36)\r\n\r\n\t\tvar script = $document.createElement(\"script\")\r\n\r\n\t\tglobal[callbackKey] = function (resp) {\r\n\t\t\tscript.parentNode.removeChild(script)\r\n\t\t\toptions.onload({\r\n\t\t\t\ttype: \"load\",\r\n\t\t\t\ttarget: {\r\n\t\t\t\t\tresponseText: resp\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tglobal[callbackKey] = undefined\r\n\t\t}\r\n\r\n\t\tscript.onerror = function () {\r\n\t\t\tscript.parentNode.removeChild(script)\r\n\r\n\t\t\toptions.onerror({\r\n\t\t\t\ttype: \"error\",\r\n\t\t\t\ttarget: {\r\n\t\t\t\t\tstatus: 500,\r\n\t\t\t\t\tresponseText: JSON.stringify({\r\n\t\t\t\t\t\terror: \"Error making jsonp request\"\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tglobal[callbackKey] = undefined\r\n\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tscript.onload = function () {\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tscript.src = options.url +\r\n\t\t\t(options.url.indexOf(\"?\") > 0 ? \"&\" : \"?\") +\r\n\t\t\t(options.callbackKey ? options.callbackKey : \"callback\") +\r\n\t\t\t\"=\" + callbackKey +\r\n\t\t\t\"&\" + buildQueryString(options.data || {})\r\n\r\n\t\t$document.body.appendChild(script)\r\n\t}\r\n\r\n\tfunction createXhr(options) {\r\n\t\tvar xhr = new global.XMLHttpRequest()\r\n\t\txhr.open(options.method, options.url, true, options.user,\r\n\t\t\toptions.password)\r\n\r\n\t\txhr.onreadystatechange = function () {\r\n\t\t\tif (xhr.readyState === 4) {\r\n\t\t\t\tif (xhr.status >= 200 && xhr.status < 300) {\r\n\t\t\t\t\toptions.onload({type: \"load\", target: xhr})\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptions.onerror({type: \"error\", target: xhr})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (options.serialize === JSON.stringify &&\r\n\t\t\t\toptions.data &&\r\n\t\t\t\toptions.method !== \"GET\") {\r\n\t\t\txhr.setRequestHeader(\"Content-Type\",\r\n\t\t\t\t\"application/json; charset=utf-8\")\r\n\t\t}\r\n\r\n\t\tif (options.deserialize === JSON.parse) {\r\n\t\t\txhr.setRequestHeader(\"Accept\", \"application/json, text/*\")\r\n\t\t}\r\n\r\n\t\tif (isFunction(options.config)) {\r\n\t\t\tvar maybeXhr = options.config(xhr, options)\r\n\t\t\tif (maybeXhr != null) xhr = maybeXhr\r\n\t\t}\r\n\r\n\t\tvar data = options.method === \"GET\" || !options.data ? \"\" : options.data\r\n\r\n\t\tif (data && !isString(data) && data.constructor !== global.FormData) {\r\n\t\t\tthrow new Error(\"Request data should be either be a string or \" +\r\n\t\t\t\t\"FormData. Check the `serialize` option in `m.request`\")\r\n\t\t}\r\n\r\n\t\txhr.send(data)\r\n\t\treturn xhr\r\n\t}\r\n\r\n\tfunction ajax(options) {\r\n\t\tif (options.dataType && options.dataType.toLowerCase() === \"jsonp\") {\r\n\t\t\treturn handleJsonp(options)\r\n\t\t} else {\r\n\t\t\treturn createXhr(options)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction bindData(options, data, serialize) {\r\n\t\tif (options.method === \"GET\" && options.dataType !== \"jsonp\") {\r\n\t\t\tvar prefix = options.url.indexOf(\"?\") < 0 ? \"?\" : \"&\"\r\n\t\t\tvar querystring = buildQueryString(data)\r\n\t\t\toptions.url += (querystring ? prefix + querystring : \"\")\r\n\t\t} else {\r\n\t\t\toptions.data = serialize(data)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction parameterizeUrl(url, data) {\r\n\t\tif (data) {\r\n\t\t\turl = url.replace(/:[a-z]\\w+/gi, function (token){\r\n\t\t\t\tvar key = token.slice(1)\r\n\t\t\t\tvar value = data[key] || token\r\n\t\t\t\tdelete data[key]\r\n\t\t\t\treturn value\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn url\r\n\t}\r\n\r\n\tm.request = function (options) {\r\n\t\tif (options.background !== true) m.startComputation()\r\n\t\tvar deferred = new Deferred()\r\n\t\tvar isJSONP = options.dataType &&\r\n\t\t\toptions.dataType.toLowerCase() === \"jsonp\"\r\n\r\n\t\tvar serialize, deserialize, extract\r\n\r\n\t\tif (isJSONP) {\r\n\t\t\tserialize = options.serialize =\r\n\t\t\tdeserialize = options.deserialize = identity\r\n\r\n\t\t\textract = function (jsonp) { return jsonp.responseText }\r\n\t\t} else {\r\n\t\t\tserialize = options.serialize = options.serialize || JSON.stringify\r\n\r\n\t\t\tdeserialize = options.deserialize =\r\n\t\t\t\toptions.deserialize || JSON.parse\r\n\t\t\textract = options.extract || function (xhr) {\r\n\t\t\t\tif (xhr.responseText.length || deserialize !== JSON.parse) {\r\n\t\t\t\t\treturn xhr.responseText\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\toptions.method = (options.method || \"GET\").toUpperCase()\r\n\t\toptions.url = parameterizeUrl(options.url, options.data)\r\n\t\tbindData(options, options.data, serialize)\r\n\t\toptions.onload = options.onerror = function (ev) {\r\n\t\t\ttry {\r\n\t\t\t\tev = ev || event\r\n\t\t\t\tvar response = deserialize(extract(ev.target, options))\r\n\t\t\t\tif (ev.type === \"load\") {\r\n\t\t\t\t\tif (options.unwrapSuccess) {\r\n\t\t\t\t\t\tresponse = options.unwrapSuccess(response, ev.target)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (isArray(response) && options.type) {\r\n\t\t\t\t\t\tforEach(response, function (res, i) {\r\n\t\t\t\t\t\t\tresponse[i] = new options.type(res)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else if (options.type) {\r\n\t\t\t\t\t\tresponse = new options.type(response)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdeferred.resolve(response)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (options.unwrapError) {\r\n\t\t\t\t\t\tresponse = options.unwrapError(response, ev.target)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdeferred.reject(response)\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tdeferred.reject(e)\r\n\t\t\t\tm.deferred.onerror(e)\r\n\t\t\t} finally {\r\n\t\t\t\tif (options.background !== true) m.endComputation()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tajax(options)\r\n\t\tdeferred.promise = propify(deferred.promise, options.initialValue)\r\n\t\treturn deferred.promise\r\n\t}\r\n\r\n\treturn m\r\n}); // eslint-disable-line\r\n\n},{}],4:[function(require,module,exports){\n(function (process){\n/*\n * PinkySwear.js 2.2.2 - Minimalistic implementation of the Promises/A+ spec\n * \n * Public Domain. Use, modify and distribute it any way you like. No attribution required.\n *\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n *\n * PinkySwear is a very small implementation of the Promises/A+ specification. After compilation with the\n * Google Closure Compiler and gzipping it weighs less than 500 bytes. It is based on the implementation for \n * Minified.js and should be perfect for embedding. \n *\n *\n * PinkySwear has just three functions.\n *\n * To create a new promise in pending state, call pinkySwear():\n *         var promise = pinkySwear();\n *\n * The returned object has a Promises/A+ compatible then() implementation:\n *          promise.then(function(value) { alert(\"Success!\"); }, function(value) { alert(\"Failure!\"); });\n *\n *\n * The promise returned by pinkySwear() is a function. To fulfill the promise, call the function with true as first argument and\n * an optional array of values to pass to the then() handler. By putting more than one value in the array, you can pass more than one\n * value to the then() handlers. Here an example to fulfill a promsise, this time with only one argument: \n *         promise(true, [42]);\n *\n * When the promise has been rejected, call it with false. Again, there may be more than one argument for the then() handler:\n *         promise(true, [6, 6, 6]);\n *         \n * You can obtain the promise's current state by calling the function without arguments. It will be true if fulfilled,\n * false if rejected, and otherwise undefined.\n * \t\t   var state = promise(); \n * \n * https://github.com/timjansen/PinkySwear.js\n */\n(function(target) {\n\tvar undef;\n\n\tfunction isFunction(f) {\n\t\treturn typeof f == 'function';\n\t}\n\tfunction isObject(f) {\n\t\treturn typeof f == 'object';\n\t}\n\tfunction defer(callback) {\n\t\tif (typeof setImmediate != 'undefined')\n\t\t\tsetImmediate(callback);\n\t\telse if (typeof process != 'undefined' && process['nextTick'])\n\t\t\tprocess['nextTick'](callback);\n\t\telse\n\t\t\tsetTimeout(callback, 0);\n\t}\n\n\ttarget[0][target[1]] = function pinkySwear(extend) {\n\t\tvar state;           // undefined/null = pending, true = fulfilled, false = rejected\n\t\tvar values = [];     // an array of values as arguments for the then() handlers\n\t\tvar deferred = [];   // functions to call when set() is invoked\n\n\t\tvar set = function(newState, newValues) {\n\t\t\tif (state == null && newState != null) {\n\t\t\t\tstate = newState;\n\t\t\t\tvalues = newValues;\n\t\t\t\tif (deferred.length)\n\t\t\t\t\tdefer(function() {\n\t\t\t\t\t\tfor (var i = 0; i < deferred.length; i++)\n\t\t\t\t\t\t\tdeferred[i]();\n\t\t\t\t\t});\n\t\t\t}\n\t\t\treturn state;\n\t\t};\n\n\t\tset['then'] = function (onFulfilled, onRejected) {\n\t\t\tvar promise2 = pinkySwear(extend);\n\t\t\tvar callCallbacks = function() {\n\t    \t\ttry {\n\t    \t\t\tvar f = (state ? onFulfilled : onRejected);\n\t    \t\t\tif (isFunction(f)) {\n\t\t   \t\t\t\tfunction resolve(x) {\n\t\t\t\t\t\t    var then, cbCalled = 0;\n\t\t   \t\t\t\t\ttry {\n\t\t\t\t   \t\t\t\tif (x && (isObject(x) || isFunction(x)) && isFunction(then = x['then'])) {\n\t\t\t\t\t\t\t\t\t\tif (x === promise2)\n\t\t\t\t\t\t\t\t\t\t\tthrow new TypeError();\n\t\t\t\t\t\t\t\t\t\tthen['call'](x,\n\t\t\t\t\t\t\t\t\t\t\tfunction() { if (!cbCalled++) resolve.apply(undef,arguments); } ,\n\t\t\t\t\t\t\t\t\t\t\tfunction(value){ if (!cbCalled++) promise2(false,[value]);});\n\t\t\t\t   \t\t\t\t}\n\t\t\t\t   \t\t\t\telse\n\t\t\t\t   \t\t\t\t\tpromise2(true, arguments);\n\t\t   \t\t\t\t\t}\n\t\t   \t\t\t\t\tcatch(e) {\n\t\t   \t\t\t\t\t\tif (!cbCalled++)\n\t\t   \t\t\t\t\t\t\tpromise2(false, [e]);\n\t\t   \t\t\t\t\t}\n\t\t   \t\t\t\t}\n\t\t   \t\t\t\tresolve(f.apply(undef, values || []));\n\t\t   \t\t\t}\n\t\t   \t\t\telse\n\t\t   \t\t\t\tpromise2(state, values);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tpromise2(false, [e]);\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (state != null)\n\t\t\t\tdefer(callCallbacks);\n\t\t\telse\n\t\t\t\tdeferred.push(callCallbacks);\n\t\t\treturn promise2;\n\t\t};\n        if(extend){\n            set = extend(set);\n        }\n\t\treturn set;\n\t};\n})(typeof module == 'undefined' ? [window, 'pinkySwear'] : [module, 'exports']);\n\n\n}).call(this,require('_process'))\n},{\"_process\":5}],5:[function(require,module,exports){\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\n(function () {\n    try {\n        cachedSetTimeout = setTimeout;\n    } catch (e) {\n        cachedSetTimeout = function () {\n            throw new Error('setTimeout is not defined');\n        }\n    }\n    try {\n        cachedClearTimeout = clearTimeout;\n    } catch (e) {\n        cachedClearTimeout = function () {\n            throw new Error('clearTimeout is not defined');\n        }\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        return setTimeout(fun, 0);\n    } else {\n        return cachedSetTimeout.call(null, fun, 0);\n    }\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        clearTimeout(marker);\n    } else {\n        cachedClearTimeout.call(null, marker);\n    }\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],6:[function(require,module,exports){\n/*! qwest 4.4.5 (https://github.com/pyrsmk/qwest) */\r\n\r\nmodule.exports = function() {\r\n\r\n\tvar global = typeof window != 'undefined' ? window : self,\r\n\t\tpinkyswear = require('pinkyswear'),\r\n\t\tjparam = require('jquery-param'),\r\n\t\tdefaultOptions = {},\r\n\t\t// Default response type for XDR in auto mode\r\n\t\tdefaultXdrResponseType = 'json',\r\n\t\t// Default data type\r\n\t\tdefaultDataType = 'post',\r\n\t\t// Variables for limit mechanism\r\n\t\tlimit = null,\r\n\t\trequests = 0,\r\n\t\trequest_stack = [],\r\n\t\t// Get XMLHttpRequest object\r\n\t\tgetXHR = global.XMLHttpRequest? function(){\r\n\t\t\treturn new global.XMLHttpRequest();\r\n\t\t}: function(){\r\n\t\t\treturn new ActiveXObject('Microsoft.XMLHTTP');\r\n\t\t},\r\n\t\t// Guess XHR version\r\n\t\txhr2 = (getXHR().responseType===''),\r\n\r\n\t// Core function\r\n\tqwest = function(method, url, data, options, before) {\r\n\t\t// Format\r\n\t\tmethod = method.toUpperCase();\r\n\t\tdata = data || null;\r\n\t\toptions = options || {};\r\n\t\tfor(var name in defaultOptions) {\r\n\t\t\tif(!(name in options)) {\r\n\t\t\t\tif(typeof defaultOptions[name] == 'object' && typeof options[name] == 'object') {\r\n\t\t\t\t\tfor(var name2 in defaultOptions[name]) {\r\n\t\t\t\t\t\toptions[name][name2] = defaultOptions[name][name2];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\toptions[name] = defaultOptions[name];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Define variables\r\n\t\tvar nativeResponseParsing = false,\r\n\t\t\tcrossOrigin,\r\n\t\t\txhr,\r\n\t\t\txdr = false,\r\n\t\t\ttimeout,\r\n\t\t\taborted = false,\r\n\t\t\tattempts = 0,\r\n\t\t\theaders = {},\r\n\t\t\tmimeTypes = {\r\n\t\t\t\ttext: '*/*',\r\n\t\t\t\txml: 'text/xml',\r\n\t\t\t\tjson: 'application/json',\r\n\t\t\t\tpost: 'application/x-www-form-urlencoded',\r\n\t\t\t\tdocument: 'text/html'\r\n\t\t\t},\r\n\t\t\taccept = {\r\n\t\t\t\ttext: '*/*',\r\n\t\t\t\txml: 'application/xml; q=1.0, text/xml; q=0.8, */*; q=0.1',\r\n\t\t\t\tjson: 'application/json; q=1.0, text/*; q=0.8, */*; q=0.1'\r\n\t\t\t},\r\n\t\t\ti, j,\r\n\t\t\tresponse,\r\n\t\t\tsending = false,\r\n\r\n\t\t// Create the promise\r\n\t\tpromise = pinkyswear(function(pinky) {\r\n\t\t\tpinky.abort = function() {\r\n\t\t\t\tif(!aborted) {\r\n\t\t\t\t\tif(xhr && xhr.readyState != 4) { // https://stackoverflow.com/questions/7287706/ie-9-javascript-error-c00c023f\r\n\t\t\t\t\t\txhr.abort();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(sending) {\r\n\t\t\t\t\t\t--requests;\r\n\t\t\t\t\t\tsending = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\taborted = true;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tpinky.send = function() {\r\n\t\t\t\t// Prevent further send() calls\r\n\t\t\t\tif(sending) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// Reached request limit, get out!\r\n\t\t\t\tif(requests == limit) {\r\n\t\t\t\t\trequest_stack.push(pinky);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// Verify if the request has not been previously aborted\r\n\t\t\t\tif(aborted) {\r\n\t\t\t\t\tif(request_stack.length) {\r\n\t\t\t\t\t\trequest_stack.shift().send();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// The sending is running\r\n\t\t\t\t++requests;\r\n\t\t\t\tsending = true;\r\n\t\t\t\t// Get XHR object\r\n\t\t\t\txhr = getXHR();\r\n\t\t\t\tif(crossOrigin) {\r\n\t\t\t\t\tif(!('withCredentials' in xhr) && global.XDomainRequest) {\r\n\t\t\t\t\t\txhr = new XDomainRequest(); // CORS with IE8/9\r\n\t\t\t\t\t\txdr = true;\r\n\t\t\t\t\t\tif(method != 'GET' && method != 'POST') {\r\n\t\t\t\t\t\t\tmethod = 'POST';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Open connection\r\n\t\t\t\tif(xdr) {\r\n\t\t\t\t\txhr.open(method, url);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\txhr.open(method, url, options.async, options.user, options.password);\r\n\t\t\t\t\tif(xhr2 && options.async) {\r\n\t\t\t\t\t\txhr.withCredentials = options.withCredentials;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Set headers\r\n\t\t\t\tif(!xdr) {\r\n\t\t\t\t\tfor(var i in headers) {\r\n\t\t\t\t\t\tif(headers[i]) {\r\n\t\t\t\t\t\t\txhr.setRequestHeader(i, headers[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Verify if the response type is supported by the current browser\r\n\t\t\t\tif(xhr2 && options.responseType != 'auto') {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\txhr.responseType = options.responseType;\r\n\t\t\t\t\t\tnativeResponseParsing = (xhr.responseType == options.responseType);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e) {}\r\n\t\t\t\t}\r\n\t\t\t\t// Plug response handler\r\n\t\t\t\tif(xhr2 || xdr) {\r\n\t\t\t\t\txhr.onload = handleResponse;\r\n\t\t\t\t\txhr.onerror = handleError;\r\n\t\t\t\t\t// http://cypressnorth.com/programming/internet-explorer-aborting-ajax-requests-fixed/\r\n\t\t\t\t\tif(xdr) {\r\n\t\t\t\t\t\txhr.onprogress = function() {};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\txhr.onreadystatechange = function() {\r\n\t\t\t\t\t\tif(xhr.readyState == 4) {\r\n\t\t\t\t\t\t\thandleResponse();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\t// Plug timeout\r\n\t\t\t\tif(options.async) {\r\n\t\t\t\t\tif('timeout' in xhr) {\r\n\t\t\t\t\t\txhr.timeout = options.timeout;\r\n\t\t\t\t\t\txhr.ontimeout = handleTimeout;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttimeout = setTimeout(handleTimeout, options.timeout);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// http://cypressnorth.com/programming/internet-explorer-aborting-ajax-requests-fixed/\r\n\t\t\t\telse if(xdr) {\r\n\t\t\t\t\txhr.ontimeout = function() {};\r\n\t\t\t\t}\r\n\t\t\t\t// Override mime type to ensure the response is well parsed\r\n\t\t\t\tif(options.responseType != 'auto' && 'overrideMimeType' in xhr) {\r\n\t\t\t\t\txhr.overrideMimeType(mimeTypes[options.responseType]);\r\n\t\t\t\t}\r\n\t\t\t\t// Run 'before' callback\r\n\t\t\t\tif(before) {\r\n\t\t\t\t\tbefore(xhr);\r\n\t\t\t\t}\r\n\t\t\t\t// Send request\r\n\t\t\t\tif(xdr) {\r\n\t\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/XDomainRequest\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\txhr.send(method != 'GET'? data : null);\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\txhr.send(method != 'GET' ? data : null);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\treturn pinky;\r\n\t\t}),\r\n\r\n\t\t// Handle the response\r\n\t\thandleResponse = function() {\r\n\t\t\tvar i, responseType;\r\n\t\t\t// Stop sending state\r\n\t\t\tsending = false;\r\n\t\t\tclearTimeout(timeout);\r\n\t\t\t// Launch next stacked request\r\n\t\t\tif(request_stack.length) {\r\n\t\t\t\trequest_stack.shift().send();\r\n\t\t\t}\r\n\t\t\t// Verify if the request has not been previously aborted\r\n\t\t\tif(aborted) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// Decrease the number of requests\r\n\t\t\t--requests;\r\n\t\t\t// Handle response\r\n\t\t\ttry{\r\n\t\t\t\t// Process response\r\n\t\t\t\tif(nativeResponseParsing) {\r\n\t\t\t\t\tif('response' in xhr && xhr.response === null) {\r\n\t\t\t\t\t\tthrow 'The request response is empty';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresponse = xhr.response;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Guess response type\r\n\t\t\t\t\tresponseType = options.responseType;\r\n\t\t\t\t\tif(responseType == 'auto') {\r\n\t\t\t\t\t\tif(xdr) {\r\n\t\t\t\t\t\t\tresponseType = defaultXdrResponseType;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tvar ct = xhr.getResponseHeader('Content-Type') || '';\r\n\t\t\t\t\t\t\tif(ct.indexOf(mimeTypes.json)>-1) {\r\n\t\t\t\t\t\t\t\tresponseType = 'json';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if(ct.indexOf(mimeTypes.xml) > -1) {\r\n\t\t\t\t\t\t\t\tresponseType = 'xml';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tresponseType = 'text';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Handle response type\r\n\t\t\t\t\tswitch(responseType) {\r\n\t\t\t\t\t\tcase 'json':\r\n\t\t\t\t\t\t\tif(xhr.responseText.length) {\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tif('JSON' in global) {\r\n\t\t\t\t\t\t\t\t\t\tresponse = JSON.parse(xhr.responseText);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\tresponse = new Function('return (' + xhr.responseText + ')')();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcatch(e) {\r\n\t\t\t\t\t\t\t\t\tthrow \"Error while parsing JSON body : \"+e;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'xml':\r\n\t\t\t\t\t\t\t// Based on jQuery's parseXML() function\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t// Standard\r\n\t\t\t\t\t\t\t\tif(global.DOMParser) {\r\n\t\t\t\t\t\t\t\t\tresponse = (new DOMParser()).parseFromString(xhr.responseText,'text/xml');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// IE<9\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tresponse = new ActiveXObject('Microsoft.XMLDOM');\r\n\t\t\t\t\t\t\t\t\tresponse.async = 'false';\r\n\t\t\t\t\t\t\t\t\tresponse.loadXML(xhr.responseText);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcatch(e) {\r\n\t\t\t\t\t\t\t\tresponse = undefined;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(!response || !response.documentElement || response.getElementsByTagName('parsererror').length) {\r\n\t\t\t\t\t\t\t\tthrow 'Invalid XML';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tresponse = xhr.responseText;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Late status code verification to allow passing data when, per example, a 409 is returned\r\n\t\t\t\t// --- https://stackoverflow.com/questions/10046972/msie-returns-status-code-of-1223-for-ajax-request\r\n\t\t\t\tif('status' in xhr && !/^2|1223/.test(xhr.status)) {\r\n\t\t\t\t\tthrow xhr.status + ' (' + xhr.statusText + ')';\r\n\t\t\t\t}\r\n\t\t\t\t// Fulfilled\r\n\t\t\t\tpromise(true, [xhr, response]);\r\n\t\t\t}\r\n\t\t\tcatch(e) {\r\n\t\t\t\t// Rejected\r\n\t\t\t\tpromise(false, [e, xhr, response]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Handle errors\r\n\t\thandleError = function(message) {\r\n\t\t\tif(!aborted) {\r\n\t\t\t\tmessage = typeof message == 'string' ? message : 'Connection aborted';\r\n\t\t\t\tpromise.abort();\r\n\t\t\t\tpromise(false, [new Error(message), xhr, null]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t\t\r\n\t\t// Handle timeouts\r\n\t\thandleTimeout = function() {\r\n\t\t\tif(!aborted) {\r\n\t\t\t\tif(!options.attempts || ++attempts != options.attempts) {\r\n\t\t\t\t\txhr.abort();\r\n\t\t\t\t\tsending = false;\r\n\t\t\t\t\tpromise.send();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\thandleError('Timeout (' + url + ')');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Normalize options\r\n\t\toptions.async = 'async' in options ? !!options.async : true;\r\n\t\toptions.cache = 'cache' in options ? !!options.cache : false;\r\n\t\toptions.dataType = 'dataType' in options ? options.dataType.toLowerCase() : defaultDataType;\r\n\t\toptions.responseType = 'responseType' in options ? options.responseType.toLowerCase() : 'auto';\r\n\t\toptions.user = options.user || '';\r\n\t\toptions.password = options.password || '';\r\n\t\toptions.withCredentials = !!options.withCredentials;\r\n\t\toptions.timeout = 'timeout' in options ? parseInt(options.timeout, 10) : 30000;\r\n\t\toptions.attempts = 'attempts' in options ? parseInt(options.attempts, 10) : 1;\r\n\r\n\t\t// Guess if we're dealing with a cross-origin request\r\n\t\ti = url.match(/\\/\\/(.+?)\\//);\r\n\t\tcrossOrigin = i && (i[1] ? i[1] != location.host : false);\r\n\r\n\t\t// Prepare data\r\n\t\tif('ArrayBuffer' in global && data instanceof ArrayBuffer) {\r\n\t\t\toptions.dataType = 'arraybuffer';\r\n\t\t}\r\n\t\telse if('Blob' in global && data instanceof Blob) {\r\n\t\t\toptions.dataType = 'blob';\r\n\t\t}\r\n\t\telse if('Document' in global && data instanceof Document) {\r\n\t\t\toptions.dataType = 'document';\r\n\t\t}\r\n\t\telse if('FormData' in global && data instanceof FormData) {\r\n\t\t\toptions.dataType = 'formdata';\r\n\t\t}\r\n\t\tif(data !== null) {\r\n\t\t\tswitch(options.dataType) {\r\n\t\t\t\tcase 'json':\r\n\t\t\t\t\tdata = JSON.stringify(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'post':\r\n\t\t\t\t\tdata = jparam(data);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Prepare headers\r\n\t\tif(options.headers) {\r\n\t\t\tvar format = function(match,p1,p2) {\r\n\t\t\t\treturn p1 + p2.toUpperCase();\r\n\t\t\t};\r\n\t\t\tfor(i in options.headers) {\r\n\t\t\t\theaders[i.replace(/(^|-)([^-])/g,format)] = options.headers[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!('Content-Type' in headers) && method!='GET') {\r\n\t\t\tif(options.dataType in mimeTypes) {\r\n\t\t\t\tif(mimeTypes[options.dataType]) {\r\n\t\t\t\t\theaders['Content-Type'] = mimeTypes[options.dataType];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!headers.Accept) {\r\n\t\t\theaders.Accept = (options.responseType in accept) ? accept[options.responseType] : '*/*';\r\n\t\t}\r\n\t\tif(!crossOrigin && !('X-Requested-With' in headers)) { // (that header breaks in legacy browsers with CORS)\r\n\t\t\theaders['X-Requested-With'] = 'XMLHttpRequest';\r\n\t\t}\r\n\t\tif(!options.cache && !('Cache-Control' in headers)) {\r\n\t\t\theaders['Cache-Control'] = 'no-cache';\r\n\t\t}\r\n\r\n\t\t// Prepare URL\r\n\t\tif(method == 'GET' && data && typeof data == 'string') {\r\n\t\t\turl += (/\\?/.test(url)?'&':'?') + data;\r\n\t\t}\r\n\r\n\t\t// Start the request\r\n\t\tif(options.async) {\r\n\t\t\tpromise.send();\r\n\t\t}\r\n\r\n\t\t// Return promise\r\n\t\treturn promise;\r\n\r\n\t};\r\n\t\r\n\t// Define external qwest object\r\n\tvar getNewPromise = function(q) {\r\n\t\t\t// Prepare\r\n\t\t\tvar promises = [],\r\n\t\t\t\tloading = 0,\r\n\t\t\t\tvalues = [];\r\n\t\t\t// Create a new promise to handle all requests\r\n\t\t\treturn pinkyswear(function(pinky) {\r\n\t\t\t\t// Basic request method\r\n\t\t\t\tvar method_index = -1,\r\n\t\t\t\t\tcreateMethod = function(method) {\r\n\t\t\t\t\t\treturn function(url, data, options, before) {\r\n\t\t\t\t\t\t\tvar index = ++method_index;\r\n\t\t\t\t\t\t\t++loading;\r\n\t\t\t\t\t\t\tpromises.push(qwest(method, pinky.base + url, data, options, before).then(function(xhr, response) {\r\n\t\t\t\t\t\t\t\tvalues[index] = arguments;\r\n\t\t\t\t\t\t\t\tif(!--loading) {\r\n\t\t\t\t\t\t\t\t\tpinky(true, values.length == 1 ? values[0] : [values]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\t\t\tpinky(false, arguments);\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\treturn pinky;\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\t\t\t\t// Define external API\r\n\t\t\t\tpinky.get = createMethod('GET');\r\n\t\t\t\tpinky.post = createMethod('POST');\r\n\t\t\t\tpinky.put = createMethod('PUT');\r\n\t\t\t\tpinky['delete'] = createMethod('DELETE');\r\n\t\t\t\tpinky['catch'] = function(f) {\r\n\t\t\t\t\treturn pinky.then(null, f);\r\n\t\t\t\t};\r\n\t\t\t\tpinky.complete = function(f) {\r\n\t\t\t\t\tvar func = function() {\r\n\t\t\t\t\t\tf(); // otherwise arguments will be passed to the callback\r\n\t\t\t\t\t};\r\n\t\t\t\t\treturn pinky.then(func, func);\r\n\t\t\t\t};\r\n\t\t\t\tpinky.map = function(type, url, data, options, before) {\r\n\t\t\t\t\treturn createMethod(type.toUpperCase()).call(this, url, data, options, before);\r\n\t\t\t\t};\r\n\t\t\t\t// Populate methods from external object\r\n\t\t\t\tfor(var prop in q) {\r\n\t\t\t\t\tif(!(prop in pinky)) {\r\n\t\t\t\t\t\tpinky[prop] = q[prop];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Set last methods\r\n\t\t\t\tpinky.send = function() {\r\n\t\t\t\t\tfor(var i=0, j=promises.length; i<j; ++i) {\r\n\t\t\t\t\t\tpromises[i].send();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn pinky;\r\n\t\t\t\t};\r\n\t\t\t\tpinky.abort = function() {\r\n\t\t\t\t\tfor(var i=0, j=promises.length; i<j; ++i) {\r\n\t\t\t\t\t\tpromises[i].abort();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn pinky;\r\n\t\t\t\t};\r\n\t\t\t\treturn pinky;\r\n\t\t\t});\r\n\t\t},\r\n\t\tq = {\r\n\t\t\tbase: '',\r\n\t\t\tget: function() {\r\n\t\t\t\treturn getNewPromise(q).get.apply(this, arguments);\r\n\t\t\t},\r\n\t\t\tpost: function() {\r\n\t\t\t\treturn getNewPromise(q).post.apply(this, arguments);\r\n\t\t\t},\r\n\t\t\tput: function() {\r\n\t\t\t\treturn getNewPromise(q).put.apply(this, arguments);\r\n\t\t\t},\r\n\t\t\t'delete': function() {\r\n\t\t\t\treturn getNewPromise(q)['delete'].apply(this, arguments);\r\n\t\t\t},\r\n\t\t\tmap: function() {\r\n\t\t\t\treturn getNewPromise(q).map.apply(this, arguments);\r\n\t\t\t},\r\n\t\t\txhr2: xhr2,\r\n\t\t\tlimit: function(by) {\r\n\t\t\t\tlimit = by;\r\n\t\t\t\treturn q;\r\n\t\t\t},\r\n\t\t\tsetDefaultOptions: function(options) {\r\n\t\t\t\tdefaultOptions = options;\r\n\t\t\t\treturn q;\r\n\t\t\t},\r\n\t\t\tsetDefaultXdrResponseType: function(type) {\r\n\t\t\t\tdefaultXdrResponseType = type.toLowerCase();\r\n\t\t\t\treturn q;\r\n\t\t\t},\r\n\t\t\tsetDefaultDataType: function(type) {\r\n\t\t\t\tdefaultDataType = type.toLowerCase();\r\n\t\t\t\treturn q;\r\n\t\t\t},\r\n\t\t\tgetOpenRequests: function() {\r\n\t\t\t\treturn requests;\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\treturn q;\r\n\r\n}();\r\n\n},{\"jquery-param\":2,\"pinkyswear\":4}],7:[function(require,module,exports){\n'use strict';\n\nvar qwest = require('qwest');\nvar m = require('mithril');\nvar serialize = require('form-serialize');\nvar views = {\n  analysis: require('./views/analysis.js'),\n  activities: require('./views/activities.js')\n};\n\nconsole.log(\"Test\");\n\nvar activities = [];\nvar maxHeartRate = localStorage.maxHeartRate || 200;\nvar zones, totals, calculating;\n\nfunction view() {\n  var map = {\n    3: Math.round(0.93 * maxHeartRate),\n    2: Math.round(0.86 * maxHeartRate),\n    1: Math.round(0.8 * maxHeartRate),\n    0: Math.round(0.7 * maxHeartRate),\n  };\n\n  if( calculating ) {\n    return [ views.analysis(m, map, totals, zones), m(\"p\", m(\"a\", { onclick: reset, href: \"#\" }, m.trust(\"&larr; Go back\"))) ];\n  }\n\n  return [\n    m('form#activity-form', [\n\n      // max HR input\n      m(\"p\", [\n        m(\"label\", \"Max Heart Rate\"),\n        m(\"input\", {\n          type: \"number\",\n          placeholder: \"Max HR\",\n          max: 250, min: 60,\n          value: maxHeartRate,\n          onchange: function(e) {\n            maxHeartRate = parseInt(e.target.value);\n            localStorage.maxHeartRate = maxHeartRate;\n          }\n        })\n      ]),\n\n      // button\n      m(\"p\", [\n        m(\"button\", {\n          type: \"button\",\n          onclick: aggregate\n        }, \"Analyse\")\n      ]),\n\n      // activity list\n      views.activities(m, activities),\n\n      // button\n      m(\"p\", [\n        m(\"button\", {\n          type: \"button\",\n          onclick: aggregate\n        }, \"Analyse\")\n      ])\n\n    ])\n  ];\n}\n\n// translate a heart rate value to the corresponding zone\nfunction getZoneForHeartRateValue(heartRate) {\n\n  if( heartRate > ( 0.93 * maxHeartRate ) ) {\n    return 4; // VO2 max\n  } else if( heartRate > ( 0.88 * maxHeartRate ) ) {\n    return 3; // Grey zone\n  } else if( heartRate > ( 0.81 * maxHeartRate ) ) {\n    return 2; // lactate treshold\n  } else if( heartRate > ( 0.7 * maxHeartRate ) ) {\n    return 1; // aerobic\n  }\n\n  return 0; // warm-up, cool-down, recovery\n}\n\nfunction aggregate() {\n  var form = document.getElementById('activity-form');\n  var data = serialize(form, { hash: true });\n  calculating = true;\n\n  for(var i=0; i < data.activities.length; i++) {\n    var activityId = data.activities[i];\n    var activity = getActivity(activityId);\n    console.log(activity);\n\n    if( activity.max_heartrate > totals.maxHeartRate) {\n      totals.maxHeartRate = activity.max_heartrate;\n    }\n\n    if( activity.max_speed > totals.maxSpeed) {\n      totals.maxSpeed = activity.max_speed;\n    }\n\n    totals.distance += activity.distance;\n    totals.movingTime += activity.moving_time;\n\n    // query streams\n    qwest.get('/api/activities/' + activityId + '/streams')\n     .then(function(xhr, data) {\n       // calculate heart rate zone\n        for(var j=0; j < data.HeartRate.Data.length; j++) {\n          var heartRate = data.HeartRate.Data[j];\n          var zoneIndex = getZoneForHeartRateValue(heartRate);\n          zones[zoneIndex]++;\n          zones[\"total\"]++;\n          m.redraw();\n        }\n    });\n  }\n\n}\n\nfunction reset() {\n  zones = {\n    4: 0,\n    3: 0,\n    2: 0,\n    1: 0,\n    0: 0,\n    \"total\": 0\n  };\n  totals = {\n    distance: 0,\n    pace: 0,\n    movingTime: 0,\n    maxSpeed: 0,\n    maxHeartRate: 0,\n  };\n  calculating = false;\n  m.redraw();\n}\n\nfunction getActivity(id) {\n  for( var i=0; i<activities.length; i++) {\n    if(activities[i].id == id) {\n      return activities[i];\n    }\n  }\n\n  throw new Error(\"No activity with ID \" + id);\n}\n\n// get all Strava activities\nqwest.get('/api/activities')\n .then(function(xhr, data) {\n    activities = data;\n    m.redraw();\n});\n\n// init on load\nwindow.onload = function() {\n  reset();\n  m.mount(document.getElementById('app'), { view: view })\n}\n\n},{\"./views/activities.js\":8,\"./views/analysis.js\":9,\"form-serialize\":1,\"mithril\":3,\"qwest\":6}],8:[function(require,module,exports){\n'use strict'\n\nvar lastChecked;\n\nfunction selectMultiple(e) {\n  if( e.shiftKey && lastChecked ) {\n    var elements = document.querySelectorAll('input[name=\"'+ e.target.name +'\"]');\n    var inRange = false;\n\n    // loop through similar elements on page\n    for( var i=0; i<elements.length; i++) {\n\n      // if in range, keep copying checked attribute\n      if( inRange ) {\n        elements[i].checked = e.target.checked;\n\n        // move out of range if at first or last element\n        if( elements[i].value === lastChecked.value || elements[i].value === e.target.value) {\n          inRange = false;\n        }\n      } else if(elements[i].value === lastChecked.value || elements[i].value === e.target.value) {\n        // if not,  keep checking if we're in range yet\n        inRange = true;\n      }\n    }\n  }\n\n  // store reference to last checked element\n  lastChecked = e.target;\n}\n\nmodule.exports = function(m, activities) {\n  return m(\"table\", [\n    // table header\n    m(\"thead\", [\n      m(\"tr\", [\n        m('th', ''),\n        m('th', 'Date'),\n        m('th', 'Name'),\n        m('th.hide-on-mobile', 'Duration'),\n        m('th.hide-on-mobile', 'Avg HR')\n      ])\n    ]),\n\n    // table data\n    m(\"tbody\", activities.map(function(a, i) {\n\n        var date = new Date(a.start_date_local);\n\n        return m(\"tr\", [\n          m('td', m(\"input\", {\n            type: \"checkbox\",\n            name: \"activities[]\",\n            value: a.id,\n            onclick: selectMultiple,\n          })),\n          m(\"td.meta\", date.toDateString()),\n          m(\"td.strong\", a.name),\n          m(\"td.centered.hide-on-mobile\", Math.round(a.elapsed_time/60) + \" min\"),\n          m(\"td.centered.hide-on-mobile\", Math.round(a.average_heartrate))\n        ])\n    }))\n\n  ]);\n}\n\n},{}],9:[function(require,module,exports){\n'use strict';\n\nfunction percentage( value, total ) {\n  if( ! value ) {\n    return 0;\n  }\n\n  return Math.round(value / total * 100);\n}\n\nfunction ltrim(string, char) {\n  while(string[0] === char) {\n    string = string.substr(1, string.length-1);\n  }\n\n  return string;\n}\n\nmodule.exports = function( m, map, totals, zones ) {\n  var zonePercentages = {\n    0: percentage(zones[0], zones.total),\n    1: percentage(zones[1], zones.total),\n    2: percentage(zones[2], zones.total),\n    3: percentage(zones[3], zones.total),\n    4: percentage(zones[4], zones.total),\n  };\n\n  var pace = new Date(null);\n  pace.setSeconds(totals.movingTime / ( totals.distance / 1000 ) );\n  var movingTime = new Date(null);\n  movingTime.setSeconds(totals.movingTime);\n\n  var maxPace = new Date(null);\n  maxPace.setSeconds(totals.maxSpeed * 1000 / 60);\n\n  return [\n    m(\"header.header\", [\n      m(\"h1\", \"Analysis\")\n    ]),\n\n    m('div.row.medium-margin', [\n\n      m('div.col.col-2', [\n        m('span.number', [\n          Math.round( totals.distance / 1000 ),\n          m('span.unit', \" km\")\n        ]),\n        m('span.label', 'Distance')\n      ]),\n\n      m('div.col.col-2', [\n        m('span.number', [\n          ltrim(movingTime.toISOString().substr(11, 8), \"0\"),\n          m('span.unit', \"\")\n        ]),\n        m('span.label', 'Moving Time')\n      ]),\n\n      m('div.col.col-2', [\n        m('span.number', [\n          ltrim(pace.toISOString().substr(14, 5),\"0\"),\n          m('span.unit', '/km')\n        ]),\n        m('span.label', \"Pace\")\n      ])\n\n    ]),\n\n    m('div.row.medium-margin', [\n\n      m('div.col.col-2', [\n        m('span.number', [\n          totals.maxHeartRate,\n          m('span.unit', \" bpm\")\n        ]),\n        m('span.label', 'Max Heart Rate')\n      ]),\n\n      m('div.col.col-2', [\n        m('span.number', [\n          ltrim(maxPace.toISOString().substr(14, 5),\"0\"),\n          m('span.unit', '/km')\n        ]),\n        m('span.label', \"Max Pace\")\n      ])\n\n    ]),\n\n    m(\"table.distribution-chart\", [\n\n      // zone 1\n      m(\"tr\", [\n        m(\"td\", \"Z1\"),\n        m(\"td\", \"Recovery\"),\n        m(\"td\", \"< \" + map[0] ),\n        m(\"td.bolded\", zonePercentages[0] + \"%\"),\n        m(\"td\", m( \"div.bar\", m(\"div.fill.z1\", { style: \"width: \" + zonePercentages[0] + \"%\" })))\n      ]),\n\n      // zone 2\n      m(\"tr\", [\n        m(\"td\", \"Z2\"),\n        m(\"td\", \"Aerobic\"),\n        m(\"td\", map[0] + \" - \" + map[1] ),\n        m(\"td.bolded\", zonePercentages[1] + \"%\"),\n        m(\"td\", m( \"div.bar\", m(\"div.fill.z2\", { style: \"width: \" + zonePercentages[1] + \"%\" })))\n      ]),\n\n      // zone 3\n      m(\"tr\", [\n        m(\"td\", \"Z3\"),\n        m(\"td\", \"Tempo\"),\n        m(\"td\", map[1] + \" - \" + map[2] ),\n        m(\"td.bolded\", zonePercentages[2] + \"%\"),\n        m(\"td\", m( \"div.bar\", m(\"div.fill.z3\", { style: \"width: \" + zonePercentages[2] + \"%\" })))\n      ]),\n\n      // zone 4\n      m(\"tr\", [\n        m(\"td\", \"Z4\"),\n        m(\"td\", \"DEATH\"),\n        m(\"td\", map[2] + \" - \" + map[3] ),\n        m(\"td.bolded\", zonePercentages[3] + \"%\"),\n        m(\"td\", m( \"div.bar\",  m(\"div.fill.z4\", { style: \"width: \" + zonePercentages[3] + \"%\" })))\n      ]),\n\n      // zone 5\n      m(\"tr\", [\n        m(\"td\", \"Z5\"),\n        m(\"td\", \"VO2Max\"),\n        m(\"td\", map[3] + \" >\" ),\n        m(\"td.bolded\", zonePercentages[4] + \"%\"),\n        m(\"td\", m( \"div.bar\", m(\"div.fill.z5\", { style: \"width: \" + zonePercentages[4] + \"%\" })))\n      ]),\n\n    ])\n  ];\n}\n\n},{}]},{},[7]);\n"],"sourceRoot":"/source/"}